# 游戏陪玩后台管理系统 - 详细设计方案

## 一、项目概述

### 1.1 项目背景
游戏陪玩行业快速发展，需要一个功能完善的后台管理系统来管理陪玩人员、客户、订单、评价等核心业务数据，实现业务的高效运营和管理。

### 1.2 技术栈
- **后端框架**: SpringBoot 2.x
- **前端框架**: Vue.js 3.x + Element Plus
- **数据库**: Oracle 19c
- **ORM框架**: MyBatis 3.x
- **项目构建**: Maven
- **JDK版本**: 1.8+
- **数据库连接池**: Druid

---

## 二、功能模块设计

### 2.1 陪玩人员管理
**核心功能**：
- 陪玩人员信息录入（昵称、真实姓名、性别、年龄、联系方式、技能等级、服务类型、单价、状态）
- 陪玩人员信息查询（按昵称、技能、状态、价格范围筛选）
- 陪玩人员信息修改（基本信息、技能、单价）
- 陪玩人员状态管理（空闲、忙碌、离线、封禁）
- 技能标签管理（英雄联盟、王者荣耀、和平精英、绝地求生等）
- 陪玩人员等级管理（青铜、白银、黄金、铂金、钻石、王者）
- 陪玩人员收益统计

**扩展功能**：
- 陪玩人员头像上传
- 陪玩人员认证信息（实名认证、技能认证）
- 陪玩人员服务评价统计
- 陪玩人员在线时长统计

---

### 2.2 客户管理
**核心功能**：
- 客户信息录入（用户名、密码、手机号、邮箱、昵称、性别、年龄、注册时间、状态）
- 客户信息查询（按用户名、手机号、注册时间筛选）
- 客户信息修改（基本信息、状态）
- 客户账户状态管理（正常、冻结、注销）
- 客户消费统计（总消费金额、订单数量、平均消费）
- 客户等级管理（普通会员、VIP会员、SVIP会员）
- 客户地址管理

**扩展功能**：
- 客户充值记录管理
- 客户登录日志
- 客户偏好设置（偏好游戏类型、陪玩人员类型）
- 客户优惠券管理

---

### 2.3 订单管理
**核心功能**：
- 订单创建（选择客户、陪玩人员、服务类型、服务时长、单价、总价）
- 订单查询（按订单号、客户、陪玩人员、时间范围、订单状态筛选）
- 订单状态管理（待支付、已支付、服务中、已完成、已取消、退款中、已退款）
- 订单详情查看（客户信息、陪玩人员信息、服务内容、支付信息）
- 订单取消与退款处理
- 订单收入统计（日收入、月收入、年收入）
- 订单评价关联

**扩展功能**：
- 订单自动取消（超时未支付）
- 订单提醒（短信/邮件通知）
- 订单发票管理
- 订单分润计算（平台抽成、陪玩人员收入）

---

### 2.4 评价与投诉管理
**核心功能**：
- 订单评价管理（星级评分、评价内容、评价时间、客户匿名评价）
- 评价查询（按订单、陪玩人员、评分筛选）
- 评价回复（陪玩人员回复客户评价）
- 投诉管理（投诉类型：服务态度、服务质量、收费问题、其他）
- 投诉处理流程（待处理、处理中、已解决、已关闭）
- 投诉处理记录（处理人、处理时间、处理结果、备注）
- 评价统计分析（陪玩人员平均评分、好评率、差评率）

**扩展功能**：
- 评价标签管理（技术好、态度好、准时等）
- 投诉证据上传（截图、录音）
- 评价内容敏感词过滤
- 自动评价（订单完成后自动好评）

---

### 2.5 财务管理
**核心功能**：
- 陪玩人员提现管理（提现申请、审核、打款、拒绝）
- 平台收入统计（服务费收入、提现手续费收入）
- 陪玩人员收入明细（订单收入、提现记录、余额）
- 客户充值管理（充值记录、充值金额、赠送金额）
- 财务报表生成（日报、周报、月报）
- 收支明细查询

---

### 2.6 系统管理
**核心功能**：
- 管理员账户管理（增删改查、角色分配、状态管理）
- 角色权限管理（角色创建、权限分配、菜单权限、操作权限）
- 系统日志管理（操作日志、登录日志、异常日志）
- 数据字典管理（游戏类型、服务类型、投诉类型等）
- 系统配置（平台抽成比例、提现门槛、自动取消时间）
- 数据备份与恢复

---

## 三、数据库设计

### 3.1 Oracle数据库架构设计

#### 3.1.1 PDB创建
```sql
-- 创建PDB陪玩数据库
CREATE PLUGGABLE DATABASE pdb_playmate
ADMIN USER admin IDENTIFIED BY admin123
ROLES = (DBA)
DEFAULT TABLESPACE users
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/users01.dbf' 
SIZE 500M AUTOEXTEND ON NEXT 100M MAXSIZE 10G
FILE_NAME_CONVERT = ('/u01/app/oracle/oradata/orcl/pdbseed/', 
                     '/u01/app/oracle/oradata/orcl/pdb_playmate/');

-- 打开PDB
ALTER PLUGGABLE DATABASE pdb_playmate OPEN;

-- 设置PDB为自动启动
ALTER PLUGGABLE DATABASE pdb_playmate SAVE STATE;
```

#### 3.1.2 表空间设计
```sql
-- 创建表空间
-- 陪玩人员表空间
CREATE TABLESPACE TBS_PLAYMATE_STAFF
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_staff01.dbf'
SIZE 500M AUTOEXTEND ON NEXT 100M MAXSIZE 5G;

-- 客户表空间
CREATE TABLESPACE TBS_PLAYMATE_CUSTOMER
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_customer01.dbf'
SIZE 500M AUTOEXTEND ON NEXT 100M MAXSIZE 5G;

-- 订单表空间
CREATE TABLESPACE TBS_PLAYMATE_ORDER
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_order01.dbf'
SIZE 1G AUTOEXTEND ON NEXT 200M MAXSIZE 10G;

-- 财务表空间
CREATE TABLESPACE TBS_PLAYMATE_FINANCE
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_finance01.dbf'
SIZE 500M AUTOEXTEND ON NEXT 100M MAXSIZE 5G;

-- 系统表空间
CREATE TABLESPACE TBS_PLAYMATE_SYSTEM
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_system01.dbf'
SIZE 300M AUTOEXTEND ON NEXT 50M MAXSIZE 3G;

-- 临时表空间
CREATE TEMPORARY TABLESPACE TBS_PLAYMATE_TEMP
TEMPFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_temp01.dbf'
SIZE 200M AUTOEXTEND ON NEXT 50M MAXSIZE 2G;

-- 撤销表空间
CREATE UNDO TABLESPACE TBS_PLAYMATE_UNDO
DATAFILE '/u01/app/oracle/oradata/orcl/pdb_playmate/tbs_undo01.dbf'
SIZE 300M AUTOEXTEND ON NEXT 50M MAXSIZE 3G;
```

---

### 3.2 数据表设计

#### 3.2.1 陪玩人员表 (TB_STAFF)
```sql
CREATE TABLE TB_STAFF (
    STAFF_ID NUMBER(10) PRIMARY KEY,
    STAFF_NAME VARCHAR2(50) NOT NULL,
    REAL_NAME VARCHAR2(50),
    GENDER CHAR(1) CHECK (GENDER IN ('M', 'F')),
    AGE NUMBER(3) CHECK (AGE BETWEEN 18 AND 60),
    PHONE VARCHAR2(20) UNIQUE NOT NULL,
    EMAIL VARCHAR2(100),
    AVATAR_URL VARCHAR2(500),
    SKILL_LEVEL VARCHAR2(20) DEFAULT '黄金',
    SERVICE_TYPE VARCHAR2(200),
    UNIT_PRICE NUMBER(10,2) DEFAULT 0 CHECK (UNIT_PRICE >= 0),
    STATUS VARCHAR2(20) DEFAULT '空闲' CHECK (STATUS IN ('空闲', '忙碌', '离线', '封禁')),
    TOTAL_ORDERS NUMBER(10) DEFAULT 0,
    TOTAL_INCOME NUMBER(10,2) DEFAULT 0,
    AVG_SCORE NUMBER(3,2) DEFAULT 5.00,
    CERT_STATUS VARCHAR2(20) DEFAULT '未认证',
    CREATE_TIME DATE DEFAULT SYSDATE,
    UPDATE_TIME DATE DEFAULT SYSDATE,
    LAST_LOGIN_TIME DATE,
    IS_DELETED CHAR(1) DEFAULT 'N'
) TABLESPACE TBS_PLAYMATE_STAFF;

-- 创建索引
CREATE INDEX IDX_STAFF_NAME ON TB_STAFF(STAFF_NAME);
CREATE INDEX IDX_STAFF_STATUS ON TB_STAFF(STATUS);
CREATE INDEX IDX_STAFF_SKILL ON TB_STAFF(SKILL_LEVEL);
CREATE INDEX IDX_STAFF_CREATE_TIME ON TB_STAFF(CREATE_TIME);

-- 创建序列
CREATE SEQUENCE SEQ_STAFF_ID START WITH 10001 INCREMENT BY 1;
```

#### 3.2.2 客户表 (TB_CUSTOMER)
```sql
CREATE TABLE TB_CUSTOMER (
    CUSTOMER_ID NUMBER(10) PRIMARY KEY,
    USERNAME VARCHAR2(50) UNIQUE NOT NULL,
    PASSWORD VARCHAR2(100) NOT NULL,
    NICKNAME VARCHAR2(50),
    PHONE VARCHAR2(20) UNIQUE NOT NULL,
    EMAIL VARCHAR2(100),
    GENDER CHAR(1) CHECK (GENDER IN ('M', 'F')),
    AGE NUMBER(3),
    AVATAR_URL VARCHAR2(500),
    MEMBER_LEVEL VARCHAR2(20) DEFAULT '普通会员',
    TOTAL_CONSUME NUMBER(10,2) DEFAULT 0,
    ORDER_COUNT NUMBER(10) DEFAULT 0,
    BALANCE NUMBER(10,2) DEFAULT 0,
    STATUS VARCHAR2(20) DEFAULT '正常' CHECK (STATUS IN ('正常', '冻结', '注销')),
    CREATE_TIME DATE DEFAULT SYSDATE,
    UPDATE_TIME DATE DEFAULT SYSDATE,
    LAST_LOGIN_TIME DATE,
    IS_DELETED CHAR(1) DEFAULT 'N'
) TABLESPACE TBS_PLAYMATE_CUSTOMER;

-- 创建索引
CREATE INDEX IDX_CUSTOMER_USERNAME ON TB_CUSTOMER(USERNAME);
CREATE INDEX IDX_CUSTOMER_PHONE ON TB_CUSTOMER(PHONE);
CREATE INDEX IDX_CUSTOMER_STATUS ON TB_CUSTOMER(STATUS);
CREATE INDEX IDX_CUSTOMER_CREATE_TIME ON TB_CUSTOMER(CREATE_TIME);

-- 创建序列
CREATE SEQUENCE SEQ_CUSTOMER_ID START WITH 20001 INCREMENT BY 1;
```

#### 3.2.3 订单表 (TB_ORDER) - 按季度分区
```sql
-- 创建订单表并按季度分区
CREATE TABLE TB_ORDER (
    ORDER_ID NUMBER(15) PRIMARY KEY,
    ORDER_NO VARCHAR2(50) UNIQUE NOT NULL,
    CUSTOMER_ID NUMBER(10) NOT NULL,
    STAFF_ID NUMBER(10) NOT NULL,
    GAME_TYPE VARCHAR2(50) NOT NULL,
    SERVICE_HOURS NUMBER(4) DEFAULT 1 CHECK (SERVICE_HOURS > 0),
    UNIT_PRICE NUMBER(10,2) NOT NULL CHECK (UNIT_PRICE >= 0),
    TOTAL_AMOUNT NUMBER(10,2) NOT NULL CHECK (TOTAL_AMOUNT >= 0),
    PLATFORM_COMMISSION NUMBER(10,2) DEFAULT 0,
    STAFF_INCOME NUMBER(10,2) DEFAULT 0,
    ORDER_STATUS VARCHAR2(20) DEFAULT '待支付' 
        CHECK (ORDER_STATUS IN ('待支付', '已支付', '服务中', '已完成', '已取消', '退款中', '已退款')),
    PAY_TIME DATE,
    START_TIME DATE,
    END_TIME DATE,
    CUSTOMER_COMMENT VARCHAR2(500),
    STAFF_COMMENT VARCHAR2(500),
    CREATE_TIME DATE DEFAULT SYSDATE,
    UPDATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N',
    CONSTRAINT FK_ORDER_CUSTOMER FOREIGN KEY (CUSTOMER_ID) REFERENCES TB_CUSTOMER(CUSTOMER_ID),
    CONSTRAINT FK_ORDER_STAFF FOREIGN KEY (STAFF_ID) REFERENCES TB_STAFF(STAFF_ID)
) TABLESPACE TBS_PLAYMATE_ORDER
PARTITION BY RANGE (CREATE_TIME) (
    PARTITION P2025_Q1 VALUES LESS THAN (TO_DATE('2025-04-01', 'YYYY-MM-DD')),
    PARTITION P2025_Q2 VALUES LESS THAN (TO_DATE('2025-07-01', 'YYYY-MM-DD')),
    PARTITION P2025_Q3 VALUES LESS THAN (TO_DATE('2025-10-01', 'YYYY-MM-DD')),
    PARTITION P2025_Q4 VALUES LESS THAN (TO_DATE('2026-01-01', 'YYYY-MM-DD')),
    PARTITION P2026_Q1 VALUES LESS THAN (TO_DATE('2026-04-01', 'YYYY-MM-DD')),
    PARTITION PMAX VALUES LESS THAN (MAXVALUE)
);

-- 创建索引
CREATE INDEX IDX_ORDER_NO ON TB_ORDER(ORDER_NO);
CREATE INDEX IDX_ORDER_CUSTOMER ON TB_ORDER(CUSTOMER_ID);
CREATE INDEX IDX_ORDER_STAFF ON TB_ORDER(STAFF_ID);
CREATE INDEX IDX_ORDER_STATUS ON TB_ORDER(ORDER_STATUS);

-- 创建序列
CREATE SEQUENCE SEQ_ORDER_ID START WITH 3000000001 INCREMENT BY 1;
```

#### 3.2.4 评价表 (TB_EVALUATION)
```sql
CREATE TABLE TB_EVALUATION (
    EVAL_ID NUMBER(12) PRIMARY KEY,
    ORDER_ID NUMBER(15) NOT NULL,
    CUSTOMER_ID NUMBER(10) NOT NULL,
    STAFF_ID NUMBER(10) NOT NULL,
    SCORE NUMBER(2) CHECK (SCORE BETWEEN 1 AND 5),
    CONTENT VARCHAR2(500),
    TAGS VARCHAR2(200),
    IS_ANONYMOUS CHAR(1) DEFAULT 'N',
    STAFF_REPLY VARCHAR2(500),
    REPLY_TIME DATE,
    CREATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N',
    CONSTRAINT FK_EVAL_ORDER FOREIGN KEY (ORDER_ID) REFERENCES TB_ORDER(ORDER_ID),
    CONSTRAINT FK_EVAL_CUSTOMER FOREIGN KEY (CUSTOMER_ID) REFERENCES TB_CUSTOMER(CUSTOMER_ID),
    CONSTRAINT FK_EVAL_STAFF FOREIGN KEY (STAFF_ID) REFERENCES TB_STAFF(STAFF_ID)
) TABLESPACE TBS_PLAYMATE_ORDER;

-- 创建索引
CREATE INDEX IDX_EVAL_ORDER ON TB_EVALUATION(ORDER_ID);
CREATE INDEX IDX_EVAL_STAFF ON TB_EVALUATION(STAFF_ID);
CREATE INDEX IDX_EVAL_SCORE ON TB_EVALUATION(SCORE);
CREATE INDEX IDX_EVAL_CREATE_TIME ON TB_EVALUATION(CREATE_TIME);

-- 创建序列
CREATE SEQUENCE SEQ_EVAL_ID START WITH 4000000001 INCREMENT BY 1;
```

#### 3.2.5 投诉表 (TB_COMPLAINT)
```sql
CREATE TABLE TB_COMPLAINT (
    COMPLAINT_ID NUMBER(12) PRIMARY KEY,
    ORDER_ID NUMBER(15),
    CUSTOMER_ID NUMBER(10) NOT NULL,
    STAFF_ID NUMBER(10),
    COMPLAINT_TYPE VARCHAR2(50) NOT NULL,
    COMPLAINT_CONTENT VARCHAR2(1000) NOT NULL,
    EVIDENCE_URL VARCHAR2(500),
    COMPLAINT_STATUS VARCHAR2(20) DEFAULT '待处理' 
        CHECK (COMPLAINT_STATUS IN ('待处理', '处理中', '已解决', '已关闭')),
    HANDLER_ID NUMBER(10),
    HANDLER_COMMENT VARCHAR2(500),
    HANDLE_TIME DATE,
    CREATE_TIME DATE DEFAULT SYSDATE,
    UPDATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N',
    CONSTRAINT FK_COMP_ORDER FOREIGN KEY (ORDER_ID) REFERENCES TB_ORDER(ORDER_ID),
    CONSTRAINT FK_COMP_CUSTOMER FOREIGN KEY (CUSTOMER_ID) REFERENCES TB_CUSTOMER(CUSTOMER_ID),
    CONSTRAINT FK_COMP_STAFF FOREIGN KEY (STAFF_ID) REFERENCES TB_STAFF(STAFF_ID)
) TABLESPACE TBS_PLAYMATE_ORDER;

-- 创建索引
CREATE INDEX IDX_COMP_STATUS ON TB_COMPLAINT(COMPLAINT_STATUS);
CREATE INDEX IDX_COMP_CREATE_TIME ON TB_COMPLAINT(CREATE_TIME);

-- 创建序列
CREATE SEQUENCE SEQ_COMPLAINT_ID START WITH 5000000001 INCREMENT BY 1;
```

#### 3.2.6 管理员表 (TB_ADMIN)
```sql
CREATE TABLE TB_ADMIN (
    ADMIN_ID NUMBER(10) PRIMARY KEY,
    USERNAME VARCHAR2(50) UNIQUE NOT NULL,
    PASSWORD VARCHAR2(100) NOT NULL,
    NICKNAME VARCHAR2(50),
    PHONE VARCHAR2(20),
    EMAIL VARCHAR2(100),
    ROLE_ID NUMBER(10) NOT NULL,
    STATUS VARCHAR2(20) DEFAULT '正常' CHECK (STATUS IN ('正常', '冻结')),
    LAST_LOGIN_TIME DATE,
    CREATE_TIME DATE DEFAULT SYSDATE,
    UPDATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N'
) TABLESPACE TBS_PLAYMATE_SYSTEM;

-- 创建索引
CREATE INDEX IDX_ADMIN_USERNAME ON TB_ADMIN(USERNAME);
CREATE INDEX IDX_ADMIN_ROLE ON TB_ADMIN(ROLE_ID);

-- 创建序列
CREATE SEQUENCE SEQ_ADMIN_ID START WITH 60001 INCREMENT BY 1;
```

#### 3.2.7 角色表 (TB_ROLE)
```sql
CREATE TABLE TB_ROLE (
    ROLE_ID NUMBER(10) PRIMARY KEY,
    ROLE_NAME VARCHAR2(50) NOT NULL,
    ROLE_DESC VARCHAR2(200),
    PERMISSIONS VARCHAR2(2000),
    CREATE_TIME DATE DEFAULT SYSDATE,
    UPDATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N'
) TABLESPACE TBS_PLAYMATE_SYSTEM;

-- 创建序列
CREATE SEQUENCE SEQ_ROLE_ID START WITH 70001 INCREMENT BY 1;

-- 插入默认角色
INSERT INTO TB_ROLE (ROLE_ID, ROLE_NAME, ROLE_DESC, PERMISSIONS) VALUES 
(SEQ_ROLE_ID.NEXTVAL, '超级管理员', '拥有所有权限', 'all');

INSERT INTO TB_ROLE (ROLE_ID, ROLE_NAME, ROLE_DESC, PERMISSIONS) VALUES 
(SEQ_ROLE_ID.NEXTVAL, '运营管理员', '陪玩人员管理、订单管理', 'staff,order,evaluation');

INSERT INTO TB_ROLE (ROLE_ID, ROLE_NAME, ROLE_DESC, PERMISSIONS) VALUES 
(SEQ_ROLE_ID.NEXTVAL, '客服人员', '投诉处理、评价管理', 'complaint,evaluation');

INSERT INTO TB_ROLE (ROLE_ID, ROLE_NAME, ROLE_DESC, PERMISSIONS) VALUES 
(SEQ_ROLE_ID.NEXTVAL, '财务人员', '财务管理、提现审核', 'finance,withdraw');

INSERT INTO TB_ROLE (ROLE_ID, ROLE_NAME, ROLE_DESC, PERMISSIONS) VALUES 
(SEQ_ROLE_ID.NEXTVAL, '查看员', '仅查看权限', 'view');
```

#### 3.2.8 数据字典表 (TB_DICTIONARY)
```sql
CREATE TABLE TB_DICTIONARY (
    DICT_ID NUMBER(10) PRIMARY KEY,
    DICT_TYPE VARCHAR2(50) NOT NULL,
    DICT_CODE VARCHAR2(50) NOT NULL,
    DICT_VALUE VARCHAR2(100) NOT NULL,
    DICT_DESC VARCHAR2(200),
    SORT_ORDER NUMBER(5) DEFAULT 0,
    CREATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N',
    UNIQUE(DICT_TYPE, DICT_CODE)
) TABLESPACE TBS_PLAYMATE_SYSTEM;

-- 创建索引
CREATE INDEX IDX_DICT_TYPE ON TB_DICTIONARY(DICT_TYPE);

-- 创建序列
CREATE SEQUENCE SEQ_DICT_ID START WITH 80001 INCREMENT BY 1;

-- 插入游戏类型
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'GAME_TYPE', 'LOL', '英雄联盟', NULL, 1, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'GAME_TYPE', 'WZRY', '王者荣耀', NULL, 2, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'GAME_TYPE', 'HPJY', '和平精英', NULL, 3, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'GAME_TYPE', 'JDCQ', '绝地求生', NULL, 4, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'GAME_TYPE', 'DNF', '地下城与勇士', NULL, 5, SYSDATE, 'N');

-- 插入技能等级
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'SKILL_LEVEL', 'BRONZE', '青铜', NULL, 1, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'SKILL_LEVEL', 'SILVER', '白银', NULL, 2, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'SKILL_LEVEL', 'GOLD', '黄金', NULL, 3, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'SKILL_LEVEL', 'PLATINUM', '铂金', NULL, 4, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'SKILL_LEVEL', 'DIAMOND', '钻石', NULL, 5, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'SKILL_LEVEL', 'MASTER', '王者', NULL, 6, SYSDATE, 'N');

-- 插入投诉类型
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'COMPLAINT_TYPE', 'ATTITUDE', '服务态度', NULL, 1, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'COMPLAINT_TYPE', 'QUALITY', '服务质量', NULL, 2, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'COMPLAINT_TYPE', 'PRICE', '收费问题', NULL, 3, SYSDATE, 'N');
INSERT INTO TB_DICTIONARY VALUES (SEQ_DICT_ID.NEXTVAL, 'COMPLAINT_TYPE', 'OTHER', '其他', NULL, 4, SYSDATE, 'N');
```

#### 3.2.9 操作日志表 (TB_OPERATION_LOG)
```sql
CREATE TABLE TB_OPERATION_LOG (
    LOG_ID NUMBER(15) PRIMARY KEY,
    ADMIN_ID NUMBER(10),
    ADMIN_NAME VARCHAR2(50),
    OPERATION_TYPE VARCHAR2(50),
    OPERATION_DESC VARCHAR2(500),
    REQUEST_URL VARCHAR2(200),
    REQUEST_METHOD VARCHAR2(20),
    REQUEST_IP VARCHAR2(50),
    REQUEST_PARAMS VARCHAR2(2000),
    RESPONSE_RESULT VARCHAR2(2000),
    EXECUTE_TIME NUMBER(10),
    CREATE_TIME DATE DEFAULT SYSDATE,
    IS_DELETED CHAR(1) DEFAULT 'N'
) TABLESPACE TBS_PLAYMATE_SYSTEM;

-- 创建索引
CREATE INDEX IDX_LOG_ADMIN ON TB_OPERATION_LOG(ADMIN_ID);
CREATE INDEX IDX_LOG_CREATE_TIME ON TB_OPERATION_LOG(CREATE_TIME);
CREATE INDEX IDX_LOG_OPERATION_TYPE ON TB_OPERATION_LOG(OPERATION_TYPE);

-- 创建序列
CREATE SEQUENCE SEQ_LOG_ID START WITH 9000000001 INCREMENT BY 1;
```

---

### 3.3 数据库对象开发

#### 3.3.1 存储过程

**存储过程1：PROC_CREATE_ORDER（创建订单）**
```sql
CREATE OR REPLACE PROCEDURE PROC_CREATE_ORDER (
    p_customer_id IN NUMBER,
    p_staff_id IN NUMBER,
    p_game_type IN VARCHAR2,
    p_service_hours IN NUMBER,
    p_unit_price IN NUMBER,
    p_order_no OUT VARCHAR2,
    p_result OUT VARCHAR2,
    p_message OUT VARCHAR2
) AS
    v_staff_status VARCHAR2(20);
    v_customer_status VARCHAR2(20);
    v_total_amount NUMBER(10,2);
    v_platform_rate NUMBER(5,2);
    v_platform_commission NUMBER(10,2);
    v_staff_income NUMBER(10,2);
BEGIN
    -- 初始化返回值
    p_result := 'SUCCESS';
    p_message := '订单创建成功';
    
    -- 检查陪玩人员状态
    SELECT STATUS INTO v_staff_status 
    FROM TB_STAFF 
    WHERE STAFF_ID = p_staff_id AND IS_DELETED = 'N';
    
    IF v_staff_status != '空闲' THEN
        p_result := 'FAIL';
        p_message := '陪玩人员当前状态为：' || v_staff_status;
        RETURN;
    END IF;
    
    -- 检查客户状态
    SELECT STATUS INTO v_customer_status 
    FROM TB_CUSTOMER 
    WHERE CUSTOMER_ID = p_customer_id AND IS_DELETED = 'N';
    
    IF v_customer_status != '正常' THEN
        p_result := 'FAIL';
        p_message := '客户账户状态异常：' || v_customer_status;
        RETURN;
    END IF;
    
    -- 计算金额
    v_total_amount := p_service_hours * p_unit_price;
    
    -- 获取平台抽成比例（默认20%）
    BEGIN
        SELECT TO_NUMBER(DICT_VALUE) INTO v_platform_rate 
        FROM TB_DICTIONARY 
        WHERE DICT_TYPE = 'PLATFORM_CONFIG' AND DICT_CODE = 'COMMISSION_RATE';
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            v_platform_rate := 0.20;
    END;
    
    v_platform_commission := v_total_amount * v_platform_rate;
    v_staff_income := v_total_amount - v_platform_commission;
    
    -- 生成订单号
    p_order_no := 'PM' || TO_CHAR(SYSDATE, 'YYYYMMDD') || LPAD(SEQ_ORDER_ID.NEXTVAL, 10, '0');
    
    -- 插入订单
    INSERT INTO TB_ORDER (
        ORDER_ID, ORDER_NO, CUSTOMER_ID, STAFF_ID, GAME_TYPE,
        SERVICE_HOURS, UNIT_PRICE, TOTAL_AMOUNT, PLATFORM_COMMISSION,
        STAFF_INCOME, ORDER_STATUS, CREATE_TIME
    ) VALUES (
        SEQ_ORDER_ID.NEXTVAL, p_order_no, p_customer_id, p_staff_id, p_game_type,
        p_service_hours, p_unit_price, v_total_amount, v_platform_commission,
        v_staff_income, '待支付', SYSDATE
    );
    
    -- 更新陪玩人员状态为忙碌
    UPDATE TB_STAFF SET 
        STATUS = '忙碌',
        UPDATE_TIME = SYSDATE 
    WHERE STAFF_ID = p_staff_id;
    
    -- 提交事务
    COMMIT;
    
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 'FAIL';
        p_message := '创建订单失败：' || SQLERRM;
END PROC_CREATE_ORDER;
/
```

**存储过程2：PROC_COMPLETE_ORDER（完成订单）**
```sql
CREATE OR REPLACE PROCEDURE PROC_COMPLETE_ORDER (
    p_order_id IN NUMBER,
    p_result OUT VARCHAR2,
    p_message OUT VARCHAR2
) AS
    v_order_status VARCHAR2(20);
    v_staff_id NUMBER(10);
    v_staff_income NUMBER(10,2);
    v_customer_id NUMBER(10);
BEGIN
    -- 初始化返回值
    p_result := 'SUCCESS';
    p_message := '订单完成成功';
    
    -- 查询订单信息
    SELECT ORDER_STATUS, STAFF_ID, STAFF_INCOME, CUSTOMER_ID 
    INTO v_order_status, v_staff_id, v_staff_income, v_customer_id
    FROM TB_ORDER 
    WHERE ORDER_ID = p_order_id;
    
    -- 检查订单状态
    IF v_order_status != '服务中' THEN
        p_result := 'FAIL';
        p_message := '订单状态异常，当前状态：' || v_order_status;
        RETURN;
    END IF;
    
    -- 更新订单状态
    UPDATE TB_ORDER SET 
        ORDER_STATUS = '已完成',
        END_TIME = SYSDATE,
        UPDATE_TIME = SYSDATE
    WHERE ORDER_ID = p_order_id;
    
    -- 更新陪玩人员状态为空闲，增加总收入和订单数
    UPDATE TB_STAFF SET 
        STATUS = '空闲',
        TOTAL_INCOME = TOTAL_INCOME + v_staff_income,
        TOTAL_ORDERS = TOTAL_ORDERS + 1,
        UPDATE_TIME = SYSDATE
    WHERE STAFF_ID = v_staff_id;
    
    -- 更新客户订单数
    UPDATE TB_CUSTOMER SET 
        ORDER_COUNT = ORDER_COUNT + 1,
        UPDATE_TIME = SYSDATE
    WHERE CUSTOMER_ID = v_customer_id;
    
    COMMIT;
    
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 'FAIL';
        p_message := '完成订单失败：' || SQLERRM;
END PROC_COMPLETE_ORDER;
/
```

**存储过程3：PROC_WITHDRAW_APPLICATION（提现申请）**
```sql
CREATE OR REPLACE PROCEDURE PROC_WITHDRAW_APPLICATION (
    p_staff_id IN NUMBER,
    p_amount IN NUMBER,
    p_result OUT VARCHAR2,
    p_message OUT VARCHAR2
) AS
    v_balance NUMBER(10,2);
    v_min_withdraw NUMBER(10,2) := 100; -- 最低提现金额
BEGIN
    -- 初始化返回值
    p_result := 'SUCCESS';
    p_message := '提现申请提交成功';
    
    -- 查询余额
    SELECT TOTAL_INCOME - NVL((SELECT SUM(p.AMOUNT) FROM TB_WITHDRAW p 
                               WHERE p.STAFF_ID = p_staff_id AND p.STATUS IN ('待审核', '处理中')), 0)
    INTO v_balance
    FROM TB_STAFF 
    WHERE STAFF_ID = p_staff_id;
    
    -- 检查余额
    IF v_balance < p_amount THEN
        p_result := 'FAIL';
        p_message := '余额不足，当前可用余额：' || v_balance;
        RETURN;
    END IF;
    
    -- 检查最低提现金额
    IF p_amount < v_min_withdraw THEN
        p_result := 'FAIL';
        p_message := '提现金额不能低于' || v_min_withdraw || '元';
        RETURN;
    END IF;
    
    -- 插入提现记录
    INSERT INTO TB_WITHDRAW (
        WITHDRAW_ID, STAFF_ID, AMOUNT, STATUS, APPLY_TIME
    ) VALUES (
        SEQ_WITHDRAW_ID.NEXTVAL, p_staff_id, p_amount, '待审核', SYSDATE
    );
    
    COMMIT;
    
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        p_result := 'FAIL';
        p_message := '提现申请失败：' || SQLERRM;
END PROC_WITHDRAW_APPLICATION;
/
```

#### 3.3.2 函数

**函数1：FUNC_CALC_STAFF_INCOME（计算陪玩人员总收入）**
```sql
CREATE OR REPLACE FUNCTION FUNC_CALC_STAFF_INCOME (
    p_staff_id IN NUMBER,
    p_start_date IN DATE DEFAULT NULL,
    p_end_date IN DATE DEFAULT NULL
) RETURN NUMBER AS
    v_total_income NUMBER(12,2) := 0;
BEGIN
    IF p_start_date IS NULL OR p_end_date IS NULL THEN
        -- 查询总收入
        SELECT NVL(SUM(STAFF_INCOME), 0) INTO v_total_income
        FROM TB_ORDER
        WHERE STAFF_ID = p_staff_id 
        AND ORDER_STATUS = '已完成'
        AND IS_DELETED = 'N';
    ELSE
        -- 查询指定时间范围的收入
        SELECT NVL(SUM(STAFF_INCOME), 0) INTO v_total_income
        FROM TB_ORDER
        WHERE STAFF_ID = p_staff_id 
        AND ORDER_STATUS = '已完成'
        AND CREATE_TIME BETWEEN p_start_date AND p_end_date
        AND IS_DELETED = 'N';
    END IF;
    
    RETURN v_total_income;
    
EXCEPTION
    WHEN OTHERS THEN
        RETURN 0;
END FUNC_CALC_STAFF_INCOME;
/
```

**函数2：FUNC_GET_STAFF_AVG_SCORE（获取陪玩人员平均评分）**
```sql
CREATE OR REPLACE FUNCTION FUNC_GET_STAFF_AVG_SCORE (
    p_staff_id IN NUMBER
) RETURN NUMBER AS
    v_avg_score NUMBER(3,2);
BEGIN
    SELECT NVL(AVG(SCORE), 5.00) INTO v_avg_score
    FROM TB_EVALUATION
    WHERE STAFF_ID = p_staff_id AND IS_DELETED = 'N';
    
    RETURN ROUND(v_avg_score, 2);
    
EXCEPTION
    WHEN OTHERS THEN
        RETURN 5.00;
END FUNC_GET_STAFF_AVG_SCORE;
/
```

**函数3：FUNC_CHECK_CUSTOMER_BALANCE（检查客户余额）**
```sql
CREATE OR REPLACE FUNCTION FUNC_CHECK_CUSTOMER_BALANCE (
    p_customer_id IN NUMBER
) RETURN NUMBER AS
    v_balance NUMBER(10,2);
BEGIN
    SELECT BALANCE INTO v_balance
    FROM TB_CUSTOMER
    WHERE CUSTOMER_ID = p_customer_id AND IS_DELETED = 'N';
    
    RETURN v_balance;
    
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RETURN 0;
    WHEN OTHERS THEN
        RETURN 0;
END FUNC_CHECK_CUSTOMER_BALANCE;
/
```

#### 3.3.3 触发器

**触发器1：TRIG_STAFF_UPDATE_TIME（更新陪玩人员信息时自动更新时间）**
```sql
CREATE OR REPLACE TRIGGER TRIG_STAFF_UPDATE_TIME
BEFORE UPDATE ON TB_STAFF
FOR EACH ROW
BEGIN
    :NEW.UPDATE_TIME := SYSDATE;
END TRIG_STAFF_UPDATE_TIME;
/
```

**触发器2：TRIG_ORDER_UPDATE_TIME（更新订单时自动更新时间）**
```sql
CREATE OR REPLACE TRIGGER TRIG_ORDER_UPDATE_TIME
BEFORE UPDATE ON TB_ORDER
FOR EACH ROW
BEGIN
    :NEW.UPDATE_TIME := SYSDATE;
END TRIG_ORDER_UPDATE_TIME;
/
```

**触发器3：TRIG_AUTO_EVALUATION（订单完成后7天自动生成评价）**
```sql
CREATE OR REPLACE TRIGGER TRIG_AUTO_EVALUATION
AFTER UPDATE OF ORDER_STATUS ON TB_ORDER
FOR EACH ROW
WHEN (NEW.ORDER_STATUS = '已完成' AND OLD.ORDER_STATUS = '服务中')
DECLARE
    v_eval_count NUMBER;
BEGIN
    -- 检查是否已有评价
    SELECT COUNT(*) INTO v_eval_count
    FROM TB_EVALUATION
    WHERE ORDER_ID = :NEW.ORDER_ID;
    
    -- 如果没有评价，自动创建好评
    IF v_eval_count = 0 THEN
        INSERT INTO TB_EVALUATION (
            EVAL_ID, ORDER_ID, CUSTOMER_ID, STAFF_ID, 
            SCORE, CONTENT, CREATE_TIME
        ) VALUES (
            SEQ_EVAL_ID.NEXTVAL, :NEW.ORDER_ID, :NEW.CUSTOMER_ID, :NEW.STAFF_ID,
            5, '系统自动好评：服务满意', SYSDATE
        );
    END IF;
END TRIG_AUTO_EVALUATION;
/
```

**触发器4：TRIG_EVALUATION_UPDATE_SCORE（评价后更新陪玩人员平均分）**
```sql
CREATE OR REPLACE TRIGGER TRIG_EVALUATION_UPDATE_SCORE
AFTER INSERT OR UPDATE OF SCORE ON TB_EVALUATION
FOR EACH ROW
DECLARE
    v_avg_score NUMBER(3,2);
BEGIN
    -- 重新计算平均分
    SELECT ROUND(AVG(SCORE), 2) INTO v_avg_score
    FROM TB_EVALUATION
    WHERE STAFF_ID = :NEW.STAFF_ID AND IS_DELETED = 'N';
    
    -- 更新陪玩人员表
    UPDATE TB_STAFF SET 
        AVG_SCORE = v_avg_score,
        UPDATE_TIME = SYSDATE
    WHERE STAFF_ID = :NEW.STAFF_ID;
END TRIG_EVALUATION_UPDATE_SCORE;
/
```

#### 3.3.4 视图

**视图1：VIEW_STAFF_PERFORMANCE（陪玩人员业绩视图）**
```sql
CREATE OR REPLACE VIEW VIEW_STAFF_PERFORMANCE AS
SELECT 
    s.STAFF_ID,
    s.STAFF_NAME,
    s.REAL_NAME,
    s.SKILL_LEVEL,
    s.UNIT_PRICE,
    s.AVG_SCORE,
    COUNT(o.ORDER_ID) AS TOTAL_ORDERS,
    NVL(SUM(o.TOTAL_AMOUNT), 0) AS TOTAL_SALES,
    NVL(SUM(o.STAFF_INCOME), 0) AS TOTAL_INCOME,
    NVL(AVG(o.TOTAL_AMOUNT), 0) AS AVG_ORDER_AMOUNT,
    s.STATUS,
    s.CREATE_TIME
FROM TB_STAFF s
LEFT JOIN TB_ORDER o ON s.STAFF_ID = o.STAFF_ID AND o.ORDER_STATUS = '已完成' AND o.IS_DELETED = 'N'
WHERE s.IS_DELETED = 'N'
GROUP BY s.STAFF_ID, s.STAFF_NAME, s.REAL_NAME, s.SKILL_LEVEL, 
         s.UNIT_PRICE, s.AVG_SCORE, s.STATUS, s.CREATE_TIME;
```

**视图2：VIEW_CUSTOMER_CONSUMPTION（客户消费统计视图）**
```sql
CREATE OR REPLACE VIEW VIEW_CUSTOMER_CONSUMPTION AS
SELECT 
    c.CUSTOMER_ID,
    c.USERNAME,
    c.NICKNAME,
    c.PHONE,
    c.MEMBER_LEVEL,
    COUNT(o.ORDER_ID) AS ORDER_COUNT,
    NVL(SUM(o.TOTAL_AMOUNT), 0) AS TOTAL_CONSUME,
    NVL(AVG(o.TOTAL_AMOUNT), 0) AS AVG_CONSUME,
    MAX(o.CREATE_TIME) AS LAST_ORDER_TIME,
    c.BALANCE,
    c.STATUS,
    c.CREATE_TIME AS REGISTER_TIME
FROM TB_CUSTOMER c
LEFT JOIN TB_ORDER o ON c.CUSTOMER_ID = o.CUSTOMER_ID AND o.ORDER_STATUS IN ('已支付', '服务中', '已完成') AND o.IS_DELETED = 'N'
WHERE c.IS_DELETED = 'N'
GROUP BY c.CUSTOMER_ID, c.USERNAME, c.NICKNAME, c.PHONE, 
         c.MEMBER_LEVEL, c.BALANCE, c.STATUS, c.CREATE_TIME;
```

**视图3：VIEW_ORDER_DETAIL（订单详情视图）**
```sql
CREATE OR REPLACE VIEW VIEW_ORDER_DETAIL AS
SELECT 
    o.ORDER_ID,
    o.ORDER_NO,
    o.CUSTOMER_ID,
    c.USERNAME AS CUSTOMER_NAME,
    c.PHONE AS CUSTOMER_PHONE,
    o.STAFF_ID,
    s.STAFF_NAME,
    s.PHONE AS STAFF_PHONE,
    o.GAME_TYPE,
    o.SERVICE_HOURS,
    o.UNIT_PRICE,
    o.TOTAL_AMOUNT,
    o.PLATFORM_COMMISSION,
    o.STAFF_INCOME,
    o.ORDER_STATUS,
    o.CREATE_TIME,
    o.PAY_TIME,
    o.START_TIME,
    o.END_TIME,
    e.SCORE,
    e.CONTENT AS EVAL_CONTENT,
    comp.COMPLAINT_ID,
    comp.COMPLAINT_STATUS
FROM TB_ORDER o
LEFT JOIN TB_CUSTOMER c ON o.CUSTOMER_ID = c.CUSTOMER_ID
LEFT JOIN TB_STAFF s ON o.STAFF_ID = s.STAFF_ID
LEFT JOIN TB_EVALUATION e ON o.ORDER_ID = e.ORDER_ID AND e.IS_DELETED = 'N'
LEFT JOIN TB_COMPLAINT comp ON o.ORDER_ID = comp.ORDER_ID AND comp.IS_DELETED = 'N'
WHERE o.IS_DELETED = 'N';
```

**视图4：VIEW_FINANCE_SUMMARY（财务汇总视图）**
```sql
CREATE OR REPLACE VIEW VIEW_FINANCE_SUMMARY AS
SELECT 
    TRUNC(CREATE_TIME) AS STAT_DATE,
    COUNT(*) AS ORDER_COUNT,
    NVL(SUM(TOTAL_AMOUNT), 0) AS TOTAL_SALES,
    NVL(SUM(PLATFORM_COMMISSION), 0) AS PLATFORM_INCOME,
    NVL(SUM(STAFF_INCOME), 0) AS STAFF_INCOME,
    COUNT(CASE WHEN ORDER_STATUS = '已完成' THEN 1 END) AS COMPLETED_COUNT,
    COUNT(CASE WHEN ORDER_STATUS = '已退款' THEN 1 END) AS REFUND_COUNT,
    NVL(SUM(CASE WHEN ORDER_STATUS = '已退款' THEN TOTAL_AMOUNT END), 0) AS REFUND_AMOUNT
FROM TB_ORDER
WHERE IS_DELETED = 'N'
GROUP BY TRUNC(CREATE_TIME)
ORDER BY STAT_DATE DESC;
```

---

### 3.4 权限管理设计

#### 3.4.1 创建角色
```sql
-- 1. 创建超级管理员角色
CREATE ROLE ROLE_SUPER_ADMIN;
GRANT ALL PRIVILEGES TO ROLE_SUPER_ADMIN;

-- 2. 创建运营管理员角色
CREATE ROLE ROLE_OPERATOR;
-- 陪玩人员管理权限
GRANT SELECT, INSERT, UPDATE ON TB_STAFF TO ROLE_OPERATOR;
GRANT SELECT, INSERT, UPDATE ON TB_DICTIONARY TO ROLE_OPERATOR;
-- 客户管理权限
GRANT SELECT, UPDATE ON TB_CUSTOMER TO ROLE_OPERATOR;
-- 订单管理权限
GRANT SELECT, UPDATE ON TB_ORDER TO ROLE_OPERATOR;
-- 评价管理权限
GRANT SELECT, UPDATE, DELETE ON TB_EVALUATION TO ROLE_OPERATOR;
-- 视图查询权限
GRANT SELECT ON VIEW_STAFF_PERFORMANCE TO ROLE_OPERATOR;
GRANT SELECT ON VIEW_ORDER_DETAIL TO ROLE_OPERATOR;
GRANT SELECT ON VIEW_CUSTOMER_CONSUMPTION TO ROLE_OPERATOR;
-- 存储过程执行权限
GRANT EXECUTE ON PROC_CREATE_ORDER TO ROLE_OPERATOR;
GRANT EXECUTE ON PROC_COMPLETE_ORDER TO ROLE_OPERATOR;

-- 3. 创建客服角色
CREATE ROLE ROLE_CUSTOMER_SERVICE;
-- 客户查看权限
GRANT SELECT ON TB_CUSTOMER TO ROLE_CUSTOMER_SERVICE;
-- 订单查看权限
GRANT SELECT ON TB_ORDER TO ROLE_CUSTOMER_SERVICE;
-- 评价管理权限
GRANT SELECT, UPDATE ON TB_EVALUATION TO ROLE_CUSTOMER_SERVICE;
-- 投诉管理权限
GRANT SELECT, INSERT, UPDATE ON TB_COMPLAINT TO ROLE_CUSTOMER_SERVICE;
-- 陪玩人员查看权限
GRANT SELECT ON TB_STAFF TO ROLE_CUSTOMER_SERVICE;
-- 视图查询权限
GRANT SELECT ON VIEW_ORDER_DETAIL TO ROLE_CUSTOMER_SERVICE;

-- 4. 创建财务角色
CREATE ROLE ROLE_FINANCE;
-- 订单查看权限
GRANT SELECT ON TB_ORDER TO ROLE_FINANCE;
-- 陪玩人员查看权限
GRANT SELECT ON TB_STAFF TO ROLE_FINANCE;
-- 客户查看权限
GRANT SELECT ON TB_CUSTOMER TO ROLE_FINANCE;
-- 提现管理权限
GRANT SELECT, INSERT, UPDATE ON TB_WITHDRAW TO ROLE_FINANCE;
-- 视图查询权限
GRANT SELECT ON VIEW_FINANCE_SUMMARY TO ROLE_FINANCE;
GRANT SELECT ON VIEW_STAFF_PERFORMANCE TO ROLE_FINANCE;
-- 存储过程执行权限
GRANT EXECUTE ON PROC_WITHDRAW_APPLICATION TO ROLE_FINANCE;

-- 5. 创建查看员角色（只读）
CREATE ROLE ROLE_VIEWER;
-- 所有表的查询权限
GRANT SELECT ON TB_STAFF TO ROLE_VIEWER;
GRANT SELECT ON TB_CUSTOMER TO ROLE_VIEWER;
GRANT SELECT ON TB_ORDER TO ROLE_VIEWER;
GRANT SELECT ON TB_EVALUATION TO ROLE_VIEWER;
GRANT SELECT ON TB_COMPLAINT TO ROLE_VIEWER;
GRANT SELECT ON TB_ADMIN TO ROLE_VIEWER;
GRANT SELECT ON TB_ROLE TO ROLE_VIEWER;
GRANT SELECT ON TB_DICTIONARY TO ROLE_VIEWER;
GRANT SELECT ON TB_OPERATION_LOG TO ROLE_VIEWER;
-- 所有视图查询权限
GRANT SELECT ON VIEW_STAFF_PERFORMANCE TO ROLE_VIEWER;
GRANT SELECT ON VIEW_CUSTOMER_CONSUMPTION TO ROLE_VIEWER;
GRANT SELECT ON VIEW_ORDER_DETAIL TO ROLE_VIEWER;
GRANT SELECT ON VIEW_FINANCE_SUMMARY TO ROLE_VIEWER;
```

#### 3.4.2 创建用户并分配角色
```sql
-- 1. 创建超级管理员用户
CREATE USER USER_SUPER_ADMIN IDENTIFIED BY SuperAdmin123 DEFAULT TABLESPACE TBS_PLAYMATE_SYSTEM;
GRANT ROLE_SUPER_ADMIN TO USER_SUPER_ADMIN;
GRANT CREATE SESSION TO USER_SUPER_ADMIN;

-- 2. 创建运营管理员用户
CREATE USER USER_OPERATOR IDENTIFIED BY Operator123 DEFAULT TABLESPACE TBS_PLAYMATE_SYSTEM;
GRANT ROLE_OPERATOR TO USER_OPERATOR;
GRANT CREATE SESSION TO USER_OPERATOR;

-- 3. 创建客服用户
CREATE USER USER_CUSTOMER_SERVICE IDENTIFIED BY CustomerService123 DEFAULT TABLESPACE TBS_PLAYMATE_SYSTEM;
GRANT ROLE_CUSTOMER_SERVICE TO USER_CUSTOMER_SERVICE;
GRANT CREATE SESSION TO USER_CUSTOMER_SERVICE;

-- 4. 创建财务用户
CREATE USER USER_FINANCE IDENTIFIED BY Finance123 DEFAULT TABLESPACE TBS_PLAYMATE_SYSTEM;
GRANT ROLE_FINANCE TO USER_FINANCE;
GRANT CREATE SESSION TO USER_FINANCE;

-- 5. 创建查看员用户
CREATE USER USER_VIEWER IDENTIFIED BY Viewer123 DEFAULT TABLESPACE TBS_PLAYMATE_SYSTEM;
GRANT ROLE_VIEWER TO USER_VIEWER;
GRANT CREATE SESSION TO USER_VIEWER;
```

---

### 3.5 闪回技术应用

#### 3.5.1 闪回表恢复误删数据
```sql
-- 1. 模拟误删除操作（删除陪玩人员数据）
DELETE FROM TB_STAFF WHERE STAFF_ID = 10001;
COMMIT;

-- 2. 查看删除前的数据（闪回查询）
SELECT * FROM TB_STAFF AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '10' MINUTE)
WHERE STAFF_ID = 10001;

-- 3. 闪回表恢复（恢复到5分钟前的状态）
FLASHBACK TABLE TB_STAFF TO TIMESTAMP (SYSTIMESTAMP - INTERVAL '5' MINUTE);

-- 4. 如果表结构被修改，需要先启用行移动
ALTER TABLE TB_STAFF ENABLE ROW MOVEMENT;
FLASHBACK TABLE TB_STAFF TO TIMESTAMP (SYSTIMESTAMP - INTERVAL '5' MINUTE);
ALTER TABLE TB_STAFF DISABLE ROW MOVEMENT;
```

#### 3.5.2 闪回删除恢复误删表
```sql
-- 1. 模拟误删表
DROP TABLE TB_DICTIONARY;

-- 2. 查看回收站中的对象
SELECT * FROM RECYCLEBIN WHERE ORIGINAL_NAME = 'TB_DICTIONARY';

-- 3. 闪回删除
FLASHBACK TABLE TB_DICTIONARY TO BEFORE DROP;

-- 4. 如果需要重命名
FLASHBACK TABLE TB_DICTIONARY TO BEFORE DROP RENAME TO TB_DICTIONARY_RESTORED;
```

#### 3.5.3 闪回查询恢复单条数据
```sql
-- 1. 模拟误更新操作
UPDATE TB_ORDER SET ORDER_STATUS = '已退款' WHERE ORDER_ID = 3000000001;
COMMIT;

-- 2. 查看更新前的数据
SELECT ORDER_STATUS FROM TB_ORDER AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '5' MINUTE)
WHERE ORDER_ID = 3000000001;

-- 3. 使用闪回查询恢复数据
UPDATE TB_ORDER o
SET ORDER_STATUS = (
    SELECT ORDER_STATUS FROM TB_ORDER AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '5' MINUTE)
    WHERE ORDER_ID = o.ORDER_ID
)
WHERE ORDER_ID = 3000000001;
```

---

## 四、前端界面设计（Vue.js）

### 4.1 项目结构
```
playmate-admin-vue/
├── public/
│   ├── index.html
│   └── favicon.ico
├── src/
│   ├── api/                    # API接口
│   │   ├── staff.js
│   │   ├── customer.js
│   │   ├── order.js
│   │   ├── evaluation.js
│   │   ├── complaint.js
│   │   ├── finance.js
│   │   └── system.js
│   ├── assets/                 # 静态资源
│   │   ├── css/
│   │   └── images/
│   ├── components/             # 公共组件
│   │   ├── CommonHeader.vue
│   │   ├── CommonSidebar.vue
│   │   ├── CommonFooter.vue
│   │   └── CommonDialog.vue
│   ├── router/                 # 路由配置
│   │   └── index.js
│   ├── store/                  # 状态管理
│   │   └── index.js
│   ├── utils/                  # 工具类
│   │   ├── request.js
│   │   └── auth.js
│   ├── views/                  # 页面视图
│   │   ├── login/
│   │   ├── dashboard/
│   │   ├── staff/
│   │   ├── customer/
│   │   ├── order/
│   │   ├── evaluation/
│   │   ├── complaint/
│   │   ├── finance/
│   │   └── system/
│   ├── App.vue
│   └── main.js
├── package.json
└── vue.config.js
```

### 4.2 主要页面设计

#### 4.2.1 登录页面
```vue
<!-- src/views/login/index.vue -->
<template>
  <div class="login-container">
    <el-form ref="loginForm" :model="loginForm" :rules="loginRules" class="login-form">
      <div class="title-container">
        <h3 class="title">游戏陪玩后台管理系统</h3>
      </div>
      
      <el-form-item prop="username">
        <el-input
          v-model="loginForm.username"
          placeholder="请输入用户名"
          prefix-icon="el-icon-user"
        />
      </el-form-item>
      
      <el-form-item prop="password">
        <el-input
          v-model="loginForm.password"
          type="password"
          placeholder="请输入密码"
          prefix-icon="el-icon-lock"
          show-password
        />
      </el-form-item>
      
      <el-form-item>
        <el-button
          type="primary"
          style="width:100%;margin-bottom:30px;"
          @click.native.prevent="handleLogin"
        >
          登录
        </el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
export default {
  name: 'Login',
  data() {
    return {
      loginForm: {
        username: '',
        password: ''
      },
      loginRules: {
        username: [{ required: true, trigger: 'blur', message: '用户名不能为空' }],
        password: [{ required: true, trigger: 'blur', message: '密码不能为空' }]
      }
    }
  },
  methods: {
    handleLogin() {
      this.$refs.loginForm.validate(valid => {
        if (valid) {
          this.$store.dispatch('user/login', this.loginForm).then(() => {
            this.$router.push({ path: '/' })
          })
        }
      })
    }
  }
}
</script>
```

#### 4.2.2 陪玩人员管理页面
```vue
<!-- src/views/staff/index.vue -->
<template>
  <div class="staff-container">
    <!-- 搜索栏 -->
    <el-card class="search-card">
      <el-form :inline="true" :model="searchForm" class="demo-form-inline">
        <el-form-item label="陪玩昵称">
          <el-input v-model="searchForm.staffName" placeholder="请输入陪玩昵称" />
        </el-form-item>
        <el-form-item label="技能等级">
          <el-select v-model="searchForm.skillLevel" placeholder="请选择">
            <el-option label="全部" value="" />
            <el-option label="青铜" value="青铜" />
            <el-option label="白银" value="白银" />
            <el-option label="黄金" value="黄金" />
            <el-option label="铂金" value="铂金" />
            <el-option label="钻石" value="钻石" />
            <el-option label="王者" value="王者" />
          </el-select>
        </el-form-item>
        <el-form-item label="状态">
          <el-select v-model="searchForm.status" placeholder="请选择">
            <el-option label="全部" value="" />
            <el-option label="空闲" value="空闲" />
            <el-option label="忙碌" value="忙碌" />
            <el-option label="离线" value="离线" />
            <el-option label="封禁" value="封禁" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">查询</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- 操作栏 -->
    <el-card class="operation-card">
      <el-button type="primary" @click="handleAdd">新增陪玩</el-button>
      <el-button type="success" @click="handleExport">导出数据</el-button>
    </el-card>

    <!-- 数据表格 -->
    <el-card class="table-card">
      <el-table
        v-loading="loading"
        :data="staffList"
        border
        style="width: 100%"
      >
        <el-table-column type="index" width="50" />
        <el-table-column prop="staffId" label="ID" width="80" />
        <el-table-column prop="staffName" label="陪玩昵称" width="120" />
        <el-table-column prop="realName" label="真实姓名" width="100" />
        <el-table-column prop="gender" label="性别" width="60">
          <template slot-scope="scope">
            {{ scope.row.gender === 'M' ? '男' : '女' }}
          </template>
        </el-table-column>
        <el-table-column prop="age" label="年龄" width="60" />
        <el-table-column prop="phone" label="手机号" width="120" />
        <el-table-column prop="skillLevel" label="技能等级" width="80" />
        <el-table-column prop="serviceType" label="服务类型" width="150" />
        <el-table-column prop="unitPrice" label="单价(元/小时)" width="100" />
        <el-table-column prop="totalOrders" label="订单数" width="80" />
        <el-table-column prop="totalIncome" label="总收入(元)" width="100" />
        <el-table-column prop="avgScore" label="评分" width="80">
          <template slot-scope="scope">
            <el-rate
              v-model="scope.row.avgScore"
              disabled
              show-score
              text-color="#ff9900"
              score-template="{value}"
            />
          </template>
        </el-table-column>
        <el-table-column prop="status" label="状态" width="80">
          <template slot-scope="scope">
            <el-tag :type="getStatusType(scope.row.status)">
              {{ scope.row.status }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="createTime" label="创建时间" width="160" />
        <el-table-column label="操作" width="200" fixed="right">
          <template slot-scope="scope">
            <el-button size="mini" @click="handleEdit(scope.row)">编辑</el-button>
            <el-button size="mini" type="danger" @click="handleDelete(scope.row)">删除</el-button>
            <el-dropdown size="mini" @command="handleCommand">
              <el-button size="mini" type="primary">
                更多<i class="el-icon-arrow-down el-icon--right" />
              </el-button>
              <el-dropdown-menu slot="dropdown">
                <el-dropdown-item :command="`detail-${scope.row.staffId}`">详情</el-dropdown-item>
                <el-dropdown-item :command="`orders-${scope.row.staffId}`">订单记录</el-dropdown-item>
                <el-dropdown-item :command="`income-${scope.row.staffId}`">收入明细</el-dropdown-item>
              </el-dropdown-menu>
            </el-dropdown>
          </template>
        </el-table-column>
      </el-table>

      <!-- 分页 -->
      <el-pagination
        :current-page="page.current"
        :page-sizes="[10, 20, 50, 100]"
        :page-size="page.size"
        :total="page.total"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </el-card>

    <!-- 新增/编辑对话框 -->
    <el-dialog :title="dialogTitle" :visible.sync="dialogVisible" width="600px">
      <el-form ref="staffForm" :model="staffForm" :rules="staffRules" label-width="100px">
        <el-form-item label="陪玩昵称" prop="staffName">
          <el-input v-model="staffForm.staffName" />
        </el-form-item>
        <el-form-item label="真实姓名" prop="realName">
          <el-input v-model="staffForm.realName" />
        </el-form-item>
        <el-form-item label="性别" prop="gender">
          <el-radio-group v-model="staffForm.gender">
            <el-radio label="M">男</el-radio>
            <el-radio label="F">女</el-radio>
          </el-radio-group>
        </el-form-item>
        <el-form-item label="年龄" prop="age">
          <el-input-number v-model="staffForm.age" :min="18" :max="60" />
        </el-form-item>
        <el-form-item label="手机号" prop="phone">
          <el-input v-model="staffForm.phone" />
        </el-form-item>
        <el-form-item label="邮箱" prop="email">
          <el-input v-model="staffForm.email" />
        </el-form-item>
        <el-form-item label="技能等级" prop="skillLevel">
          <el-select v-model="staffForm.skillLevel" placeholder="请选择">
            <el-option label="青铜" value="青铜" />
            <el-option label="白银" value="白银" />
            <el-option label="黄金" value="黄金" />
            <el-option label="铂金" value="铂金" />
            <el-option label="钻石" value="钻石" />
            <el-option label="王者" value="王者" />
          </el-select>
        </el-form-item>
        <el-form-item label="服务类型" prop="serviceType">
          <el-checkbox-group v-model="staffForm.serviceType">
            <el-checkbox label="英雄联盟" />
            <el-checkbox label="王者荣耀" />
            <el-checkbox label="和平精英" />
            <el-checkbox label="绝地求生" />
          </el-checkbox-group>
        </el-form-item>
        <el-form-item label="单价(元/小时)" prop="unitPrice">
          <el-input-number v-model="staffForm.unitPrice" :min="0" :precision="2" />
        </el-form-item>
        <el-form-item label="状态" prop="status">
          <el-select v-model="staffForm.status" placeholder="请选择">
            <el-option label="空闲" value="空闲" />
            <el-option label="忙碌" value="忙碌" />
            <el-option label="离线" value="离线" />
            <el-option label="封禁" value="封禁" />
          </el-select>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="dialogVisible = false">取 消</el-button>
        <el-button type="primary" @click="handleSubmit">确 定</el-button>
      </div>
    </el-dialog>
  </div>
</template>

<script>
import { getStaffList, addStaff, updateStaff, deleteStaff } from '@/api/staff'

export default {
  name: 'StaffManagement',
  data() {
    return {
      loading: false,
      searchForm: {
        staffName: '',
        skillLevel: '',
        status: ''
      },
      staffList: [],
      page: {
        current: 1,
        size: 10,
        total: 0
      },
      dialogVisible: false,
      dialogTitle: '',
      staffForm: {
        staffName: '',
        realName: '',
        gender: 'M',
        age: 18,
        phone: '',
        email: '',
        skillLevel: '黄金',
        serviceType: [],
        unitPrice: 50,
        status: '空闲'
      },
      staffRules: {
        staffName: [{ required: true, message: '请输入陪玩昵称', trigger: 'blur' }],
        realName: [{ required: true, message: '请输入真实姓名', trigger: 'blur' }],
        phone: [{ required: true, message: '请输入手机号', trigger: 'blur' }]
      }
    }
  },
  created() {
    this.fetchData()
  },
  methods: {
    fetchData() {
      this.loading = true
      getStaffList({
        ...this.searchForm,
        page: this.page.current,
        size: this.page.size
      }).then(response => {
        this.staffList = response.data.records
        this.page.total = response.data.total
        this.loading = false
      })
    },
    handleSearch() {
      this.page.current = 1
      this.fetchData()
    },
    handleReset() {
      this.searchForm = {
        staffName: '',
        skillLevel: '',
        status: ''
      }
      this.handleSearch()
    },
    handleAdd() {
      this.dialogTitle = '新增陪玩'
      this.staffForm = {
        staffName: '',
        realName: '',
        gender: 'M',
        age: 18,
        phone: '',
        email: '',
        skillLevel: '黄金',
        serviceType: [],
        unitPrice: 50,
        status: '空闲'
      }
      this.dialogVisible = true
    },
    handleEdit(row) {
      this.dialogTitle = '编辑陪玩'
      this.staffForm = { ...row }
      this.staffForm.serviceType = row.serviceType ? row.serviceType.split(',') : []
      this.dialogVisible = true
    },
    handleDelete(row) {
      this.$confirm('确认删除该陪玩人员吗?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        deleteStaff(row.staffId).then(() => {
          this.$message.success('删除成功')
          this.fetchData()
        })
      })
    },
    handleSubmit() {
      this.$refs.staffForm.validate(valid => {
        if (valid) {
          const formData = {
            ...this.staffForm,
            serviceType: this.staffForm.serviceType.join(',')
          }
          if (this.dialogTitle === '新增陪玩') {
            addStaff(formData).then(() => {
              this.$message.success('新增成功')
              this.dialogVisible = false
              this.fetchData()
            })
          } else {
            updateStaff(formData).then(() => {
              this.$message.success('更新成功')
              this.dialogVisible = false
              this.fetchData()
            })
          }
        }
      })
    },
    handleSizeChange(val) {
      this.page.size = val
      this.fetchData()
    },
    handleCurrentChange(val) {
      this.page.current = val
      this.fetchData()
    },
    getStatusType(status) {
      const types = {
        '空闲': 'success',
        '忙碌': 'warning',
        '离线': 'info',
        '封禁': 'danger'
      }
      return types[status] || 'info'
    },
    handleCommand(command) {
      const [action, id] = command.split('-')
      if (action === 'detail') {
        this.$router.push(`/staff/detail/${id}`)
      } else if (action === 'orders') {
        this.$router.push(`/order?staffId=${id}`)
      } else if (action === 'income') {
        this.$router.push(`/finance/income?staffId=${id}`)
      }
    }
  }
}
</script>

<style scoped>
.staff-container {
  padding: 20px;
}
.search-card, .operation-card, .table-card {
  margin-bottom: 20px;
}
</style>
```

#### 4.2.3 订单管理页面
```vue
<!-- src/views/order/index.vue -->
<template>
  <div class="order-container">
    <!-- 搜索栏 -->
    <el-card class="search-card">
      <el-form :inline="true" :model="searchForm" class="demo-form-inline">
        <el-form-item label="订单号">
          <el-input v-model="searchForm.orderNo" placeholder="请输入订单号" />
        </el-form-item>
        <el-form-item label="客户">
          <el-input v-model="searchForm.customerName" placeholder="请输入客户名" />
        </el-form-item>
        <el-form-item label="陪玩">
          <el-input v-model="searchForm.staffName" placeholder="请输入陪玩昵称" />
        </el-form-item>
        <el-form-item label="游戏类型">
          <el-select v-model="searchForm.gameType" placeholder="请选择">
            <el-option label="全部" value="" />
            <el-option label="英雄联盟" value="英雄联盟" />
            <el-option label="王者荣耀" value="王者荣耀" />
            <el-option label="和平精英" value="和平精英" />
            <el-option label="绝地求生" value="绝地求生" />
          </el-select>
        </el-form-item>
        <el-form-item label="订单状态">
          <el-select v-model="searchForm.orderStatus" placeholder="请选择">
            <el-option label="全部" value="" />
            <el-option label="待支付" value="待支付" />
            <el-option label="已支付" value="已支付" />
            <el-option label="服务中" value="服务中" />
            <el-option label="已完成" value="已完成" />
            <el-option label="已取消" value="已取消" />
            <el-option label="退款中" value="退款中" />
            <el-option label="已退款" value="已退款" />
          </el-select>
        </el-form-item>
        <el-form-item label="创建时间">
          <el-date-picker
            v-model="searchForm.createTimeRange"
            type="daterange"
            range-separator="至"
            start-placeholder="开始日期"
            end-placeholder="结束日期"
            value-format="yyyy-MM-dd"
          />
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">查询</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- 操作栏 -->
    <el-card class="operation-card">
      <el-button type="primary" @click="handleCreateOrder">创建订单</el-button>
      <el-button type="success" @click="handleExport">导出数据</el-button>
      <el-button type="warning" @click="handleBatchCancel">批量取消</el-button>
    </el-card>

    <!-- 统计卡片 -->
    <el-row :gutter="20" class="statistics-row">
      <el-col :span="6">
        <el-card class="statistics-card">
          <div class="statistics-item">
            <div class="statistics-label">今日订单</div>
            <div class="statistics-value">{{ statistics.todayOrders }}</div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="statistics-card">
          <div class="statistics-item">
            <div class="statistics-label">今日收入</div>
            <div class="statistics-value">¥{{ statistics.todayIncome }}</div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="statistics-card">
          <div class="statistics-item">
            <div class="statistics-label">待处理订单</div>
            <div class="statistics-value">{{ statistics.pendingOrders }}</div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="statistics-card">
          <div class="statistics-item">
            <div class="statistics-label">已完成订单</div>
            <div class="statistics-value">{{ statistics.completedOrders }}</div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- 数据表格 -->
    <el-card class="table-card">
      <el-table
        v-loading="loading"
        :data="orderList"
        border
        style="width: 100%"
        @selection-change="handleSelectionChange"
      >
        <el-table-column type="selection" width="55" />
        <el-table-column type="index" width="50" />
        <el-table-column prop="orderNo" label="订单号" width="180" />
        <el-table-column prop="customerName" label="客户名称" width="120" />
        <el-table-column prop="staffName" label="陪玩昵称" width="120" />
        <el-table-column prop="gameType" label="游戏类型" width="100" />
        <el-table-column prop="serviceHours" label="服务时长(小时)" width="100" />
        <el-table-column prop="unitPrice" label="单价" width="80" />
        <el-table-column prop="totalAmount" label="总金额" width="100" />
        <el-table-column prop="orderStatus" label="订单状态" width="100">
          <template slot-scope="scope">
            <el-tag :type="getStatusType(scope.row.orderStatus)">
              {{ scope.row.orderStatus }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column prop="createTime" label="创建时间" width="160" />
        <el-table-column prop="payTime" label="支付时间" width="160" />
        <el-table-column label="操作" width="200" fixed="right">
          <template slot-scope="scope">
            <el-button size="mini" @click="handleDetail(scope.row)">详情</el-button>
            <el-button 
              v-if="scope.row.orderStatus === '待支付'" 
              size="mini" 
              type="success"
              @click="handlePay(scope.row)"
            >
              确认支付
            </el-button>
            <el-button 
              v-if="scope.row.orderStatus === '已支付'" 
              size="mini" 
              type="primary"
              @click="handleStart(scope.row)"
            >
              开始服务
            </el-button>
            <el-button 
              v-if="scope.row.orderStatus === '服务中'" 
              size="mini" 
              type="warning"
              @click="handleComplete(scope.row)"
            >
              完成服务
            </el-button>
            <el-button 
              v-if="['待支付', '已支付'].includes(scope.row.orderStatus)" 
              size="mini" 
              type="danger"
              @click="handleCancel(scope.row)"
            >
              取消
            </el-button>
          </template>
        </el-table-column>
      </el-table>

      <!-- 分页 -->
      <el-pagination
        :current-page="page.current"
        :page-sizes="[10, 20, 50, 100]"
        :page-size="page.size"
        :total="page.total"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
      />
    </el-card>

    <!-- 创建订单对话框 -->
    <el-dialog title="创建订单" :visible.sync="createDialogVisible" width="600px">
      <el-form ref="orderForm" :model="orderForm" :rules="orderRules" label-width="100px">
        <el-form-item label="选择客户" prop="customerId">
          <el-select v-model="orderForm.customerId" filterable placeholder="请选择客户">
            <el-option
              v-for="customer in customerList"
              :key="customer.customerId"
              :label="customer.username"
              :value="customer.customerId"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="选择陪玩" prop="staffId">
          <el-select v-model="orderForm.staffId" filterable placeholder="请选择陪玩">
            <el-option
              v-for="staff in availableStaffList"
              :key="staff.staffId"
              :label="`${staff.staffName} - ${staff.skillLevel} - ¥${staff.unitPrice}/小时`"
              :value="staff.staffId"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="游戏类型" prop="gameType">
          <el-select v-model="orderForm.gameType" placeholder="请选择">
            <el-option label="英雄联盟" value="英雄联盟" />
            <el-option label="王者荣耀" value="王者荣耀" />
            <el-option label="和平精英" value="和平精英" />
            <el-option label="绝地求生" value="绝地求生" />
          </el-select>
        </el-form-item>
        <el-form-item label="服务时长" prop="serviceHours">
          <el-input-number v-model="orderForm.serviceHours" :min="1" :max="24" />
          <span style="margin-left: 10px;">小时</span>
        </el-form-item>
        <el-form-item label="单价">
          <span>{{ orderForm.unitPrice }} 元/小时</span>
        </el-form-item>
        <el-form-item label="总金额">
          <span style="color: #f56c6c; font-size: 18px; font-weight: bold;">
            ¥{{ orderForm.serviceHours * orderForm.unitPrice }}
          </span>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="createDialogVisible = false">取 消</el-button>
        <el-button type="primary" @click="handleCreateSubmit">创 建</el-button>
      </div>
    </el-dialog>
  </div>
</template>

<script>
import { 
  getOrderList, 
  createOrder, 
  updateOrderStatus,
  getOrderStatistics 
} from '@/api/order'
import { getCustomerList } from '@/api/customer'
import { getStaffList } from '@/api/staff'

export default {
  name: 'OrderManagement',
  data() {
    return {
      loading: false,
      searchForm: {
        orderNo: '',
        customerName: '',
        staffName: '',
        gameType: '',
        orderStatus: '',
        createTimeRange: []
      },
      orderList: [],
      page: {
        current: 1,
        size: 10,
        total: 0
      },
      statistics: {
        todayOrders: 0,
        todayIncome: 0,
        pendingOrders: 0,
        completedOrders: 0
      },
      createDialogVisible: false,
      customerList: [],
      availableStaffList: [],
      orderForm: {
        customerId: '',
        staffId: '',
        gameType: '',
        serviceHours: 1,
        unitPrice: 50
      },
      orderRules: {
        customerId: [{ required: true, message: '请选择客户', trigger: 'change' }],
        staffId: [{ required: true, message: '请选择陪玩', trigger: 'change' }],
        gameType: [{ required: true, message: '请选择游戏类型', trigger: 'change' }],
        serviceHours: [{ required: true, message: '请输入服务时长', trigger: 'blur' }]
      },
      multipleSelection: []
    }
  },
  watch: {
    'orderForm.staffId'(newVal) {
      if (newVal) {
        const staff = this.availableStaffList.find(s => s.staffId === newVal)
        if (staff) {
          this.orderForm.unitPrice = staff.unitPrice
        }
      }
    }
  },
  created() {
    this.fetchData()
    this.fetchStatistics()
  },
  methods: {
    fetchData() {
      this.loading = true
      const params = {
        ...this.searchForm,
        page: this.page.current,
        size: this.page.size
      }
      if (this.searchForm.createTimeRange && this.searchForm.createTimeRange.length === 2) {
        params.startTime = this.searchForm.createTimeRange[0]
        params.endTime = this.searchForm.createTimeRange[1]
      }
      getOrderList(params).then(response => {
        this.orderList = response.data.records
        this.page.total = response.data.total
        this.loading = false
      })
    },
    fetchStatistics() {
      getOrderStatistics().then(response => {
        this.statistics = response.data
      })
    },
    handleSearch() {
      this.page.current = 1
      this.fetchData()
    },
    handleReset() {
      this.searchForm = {
        orderNo: '',
        customerName: '',
        staffName: '',
        gameType: '',
        orderStatus: '',
        createTimeRange: []
      }
      this.handleSearch()
    },
    handleCreateOrder() {
      // 加载客户和陪玩列表
      getCustomerList({ page: 1, size: 1000 }).then(response => {
        this.customerList = response.data.records
      })
      getStaffList({ page: 1, size: 1000, status: '空闲' }).then(response => {
        this.availableStaffList = response.data.records
      })
      this.createDialogVisible = true
    },
    handleCreateSubmit() {
      this.$refs.orderForm.validate(valid => {
        if (valid) {
          createOrder(this.orderForm).then(() => {
            this.$message.success('订单创建成功')
            this.createDialogVisible = false
            this.fetchData()
            this.fetchStatistics()
          })
        }
      })
    },
    handleDetail(row) {
      this.$router.push(`/order/detail/${row.orderId}`)
    },
    handlePay(row) {
      this.$confirm('确认该订单已支付?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        updateOrderStatus(row.orderId, '已支付').then(() => {
          this.$message.success('操作成功')
          this.fetchData()
          this.fetchStatistics()
        })
      })
    },
    handleStart(row) {
      this.$confirm('确认开始服务?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        updateOrderStatus(row.orderId, '服务中').then(() => {
          this.$message.success('操作成功')
          this.fetchData()
          this.fetchStatistics()
        })
      })
    },
    handleComplete(row) {
      this.$confirm('确认完成服务?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        updateOrderStatus(row.orderId, '已完成').then(() => {
          this.$message.success('操作成功')
          this.fetchData()
          this.fetchStatistics()
        })
      })
    },
    handleCancel(row) {
      this.$confirm('确认取消该订单?', '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        updateOrderStatus(row.orderId, '已取消').then(() => {
          this.$message.success('取消成功')
          this.fetchData()
          this.fetchStatistics()
        })
      })
    },
    handleSelectionChange(val) {
      this.multipleSelection = val
    },
    handleBatchCancel() {
      if (this.multipleSelection.length === 0) {
        this.$message.warning('请选择要取消的订单')
        return
      }
      this.$confirm(`确认批量取消${this.multipleSelection.length}个订单?`, '提示', {
        confirmButtonText: '确定',
        cancelButtonText: '取消',
        type: 'warning'
      }).then(() => {
        const orderIds = this.multipleSelection.map(item => item.orderId)
        // 调用批量取消接口
        this.$message.success('批量取消成功')
        this.fetchData()
        this.fetchStatistics()
      })
    },
    handleExport() {
      this.$message.success('导出功能开发中...')
    },
    handleSizeChange(val) {
      this.page.size = val
      this.fetchData()
    },
    handleCurrentChange(val) {
      this.page.current = val
      this.fetchData()
    },
    getStatusType(status) {
      const types = {
        '待支付': 'warning',
        '已支付': 'primary',
        '服务中': 'info',
        '已完成': 'success',
        '已取消': 'danger',
        '退款中': 'warning',
        '已退款': 'danger'
      }
      return types[status] || 'info'
    }
  }
}
</script>

<style scoped>
.order-container {
  padding: 20px;
}
.search-card, .operation-card, .table-card {
  margin-bottom: 20px;
}
.statistics-row {
  margin-bottom: 20px;
}
.statistics-card {
  height: 100px;
}
.statistics-item {
  text-align: center;
}
.statistics-label {
  font-size: 14px;
  color: #909399;
  margin-bottom: 10px;
}
.statistics-value {
  font-size: 24px;
  font-weight: bold;
  color: #303133;
}
</style>
```

---

## 五、后端接口设计（SpringBoot）

### 5.1 项目结构
```
playmate-admin-springboot/
├── src/main/java/com/playmate/admin/
│   ├── config/                 # 配置类
│   │   ├── MyBatisConfig.java
│   │   ├── DruidConfig.java
│   │   ├── SwaggerConfig.java
│   │   └── CorsConfig.java
│   ├── controller/             # 控制器
│   │   ├── AdminController.java
│   │   ├── StaffController.java
│   │   ├── CustomerController.java
│   │   ├── OrderController.java
│   │   ├── EvaluationController.java
│   │   ├── ComplaintController.java
│   │   ├── FinanceController.java
│   │   └── SystemController.java
│   ├── mapper/                 # MyBatis Mapper
│   │   ├── StaffMapper.java
│   │   ├── CustomerMapper.java
│   │   ├── OrderMapper.java
│   │   └── ...
│   ├── model/                  # 实体类
│   │   ├── entity/             # 数据库实体
│   │   ├── dto/                # DTO
│   │   └── vo/                 # VO
│   ├── service/                # 服务层
│   │   ├── impl/               # 实现类
│   │   └── ...
│   ├── util/                   # 工具类
│   │   ├── Result.java
│   │   ├── PageResult.java
│   │   └── DateUtil.java
│   └── PlaymateAdminApplication.java
├── src/main/resources/
│   ├── mapper/                 # MyBatis XML
│   │   ├── StaffMapper.xml
│   │   ├── CustomerMapper.xml
│   │   └── ...
│   ├── application.yml
│   ├── application-dev.yml
│   └── logback-spring.xml
└── pom.xml
```

### 5.2 配置文件

#### application.yml
```yaml
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  profiles:
    active: dev
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: oracle.jdbc.OracleDriver
    url: jdbc:oracle:thin:@localhost:1521:pdb_playmate
    username: playmate_admin
    password: playmate123
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      validation-query: SELECT 1 FROM DUAL

mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.playmate.admin.model.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

logging:
  level:
    com.playmate.admin.mapper: debug
```

### 5.3 核心代码示例

#### 5.3.1 统一返回结果类
```java
package com.playmate.admin.util;

public class Result<T> {
    private Integer code;
    private String message;
    private T data;
    private Long timestamp;

    public Result() {
        this.timestamp = System.currentTimeMillis();
    }

    public Result(Integer code, String message, T data) {
        this.code = code;
        this.message = message;
        this.data = data;
        this.timestamp = System.currentTimeMillis();
    }

    public static <T> Result<T> success() {
        return new Result<>(200, "操作成功", null);
    }

    public static <T> Result<T> success(T data) {
        return new Result<>(200, "操作成功", data);
    }

    public static <T> Result<T> success(String message, T data) {
        return new Result<>(200, message, data);
    }

    public static <T> Result<T> error(String message) {
        return new Result<>(500, message, null);
    }

    public static <T> Result<T> error(Integer code, String message) {
        return new Result<>(code, message, null);
    }

    // getter and setter...
}
```

#### 5.3.2 分页结果类
```java
package com.playmate.admin.util;

import java.util.List;

public class PageResult<T> {
    private Long total;
    private List<T> records;
    private Long size;
    private Long current;

    public PageResult() {}

    public PageResult(Long total, List<T> records) {
        this.total = total;
        this.records = records;
    }

    public PageResult(Long total, List<T> records, Long size, Long current) {
        this.total = total;
        this.records = records;
        this.size = size;
        this.current = current;
    }

    // getter and setter...
}
```

#### 5.3.3 订单Controller
```java
package com.playmate.admin.controller;

import com.playmate.admin.model.entity.Order;
import com.playmate.admin.model.dto.OrderQueryDTO;
import com.playmate.admin.model.dto.OrderCreateDTO;
import com.playmate.admin.service.OrderService;
import com.playmate.admin.util.Result;
import com.playmate.admin.util.PageResult;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/order")
@CrossOrigin
public class OrderController {

    @Autowired
    private OrderService orderService;

    /**
     * 创建订单
     */
    @PostMapping("/create")
    public Result<String> createOrder(@RequestBody OrderCreateDTO orderDTO) {
        try {
            String orderNo = orderService.createOrder(orderDTO);
            return Result.success("订单创建成功", orderNo);
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 分页查询订单列表
     */
    @GetMapping("/list")
    public Result<PageResult<Order>> getOrderList(OrderQueryDTO queryDTO) {
        try {
            PageResult<Order> pageResult = orderService.getOrderList(queryDTO);
            return Result.success(pageResult);
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 根据ID查询订单详情
     */
    @GetMapping("/detail/{orderId}")
    public Result<Order> getOrderById(@PathVariable Long orderId) {
        try {
            Order order = orderService.getOrderById(orderId);
            return Result.success(order);
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 更新订单状态
     */
    @PutMapping("/status/{orderId}")
    public Result<Void> updateOrderStatus(
            @PathVariable Long orderId,
            @RequestParam String status) {
        try {
            orderService.updateOrderStatus(orderId, status);
            return Result.success("状态更新成功");
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 取消订单
     */
    @PutMapping("/cancel/{orderId}")
    public Result<Void> cancelOrder(@PathVariable Long orderId) {
        try {
            orderService.cancelOrder(orderId);
            return Result.success("订单取消成功");
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 完成订单
     */
    @PutMapping("/complete/{orderId}")
    public Result<Void> completeOrder(@PathVariable Long orderId) {
        try {
            orderService.completeOrder(orderId);
            return Result.success("订单完成成功");
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 获取订单统计信息
     */
    @GetMapping("/statistics")
    public Result<Map<String, Object>> getOrderStatistics() {
        try {
            Map<String, Object> statistics = orderService.getOrderStatistics();
            return Result.success(statistics);
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }

    /**
     * 批量取消订单
     */
    @PutMapping("/batch/cancel")
    public Result<Void> batchCancelOrder(@RequestBody List<Long> orderIds) {
        try {
            orderService.batchCancelOrder(orderIds);
            return Result.success("批量取消成功");
        } catch (Exception e) {
            return Result.error(e.getMessage());
        }
    }
}
```

---

## 六、AI生成提示词（详细版）

### 6.1 数据库设计提示词

**提示词1：生成Oracle数据库表空间和PDB创建SQL**
```
请生成Oracle 19c数据库的PDB创建和表空间创建SQL语句，要求如下：

1. 创建一个名为"pdb_playmate"的可插拔数据库
2. 创建以下表空间：
   - TBS_PLAYMATE_STAFF：陪玩人员表空间，初始大小500M，自动扩展100M，最大5G
   - TBS_PLAYMATE_CUSTOMER：客户表空间，初始大小500M，自动扩展100M，最大5G
   - TBS_PLAYMATE_ORDER：订单表空间，初始大小1G，自动扩展200M，最大10G
   - TBS_PLAYMATE_FINANCE：财务表空间，初始大小500M，自动扩展100M，最大5G
   - TBS_PLAYMATE_SYSTEM：系统表空间，初始大小300M，自动扩展50M，最大3G
   - TBS_PLAYMATE_TEMP：临时表空间，初始大小200M，自动扩展50M，最大2G
   - TBS_PLAYMATE_UNDO：撤销表空间，初始大小300M，自动扩展50M，最大3G

3. 每个表空间指定独立的数据文件路径
4. 设置字符集为AL32UTF8

请提供完整的SQL脚本，包括创建PDB、打开PDB、创建表空间等所有步骤。
```

**提示词2：生成游戏陪玩系统数据库表设计**
```
请为游戏陪玩后台管理系统设计Oracle数据库表结构，包含以下表：

1. TB_STAFF（陪玩人员表）：
   - 字段：staff_id, staff_name, real_name, gender, age, phone, email, 
           avatar_url, skill_level, service_type, unit_price, status, 
           total_orders, total_income, avg_score, cert_status, create_time, 
           update_time, last_login_time, is_deleted
   - 约束：主键、唯一约束（手机号）、检查约束（性别、年龄、单价、状态）
   - 索引：staff_name, status, skill_level, create_time

2. TB_CUSTOMER（客户表）：
   - 字段：customer_id, username, password, nickname, phone, email, 
           gender, age, avatar_url, member_level, total_consume, 
           order_count, balance, status, create_time, update_time, 
           last_login_time, is_deleted
   - 约束：主键、唯一约束（用户名、手机号）、检查约束（状态）

3. TB_ORDER（订单表）：
   - 字段：order_id, order_no, customer_id, staff_id, game_type, 
           service_hours, unit_price, total_amount, platform_commission, 
           staff_income, order_status, pay_time, start_time, end_time, 
           customer_comment, staff_comment, create_time, update_time, is_deleted
   - 约束：主键、外键（customer_id, staff_id）、检查约束
   - 分区：按创建时间按季度分区（范围分区）

4. TB_EVALUATION（评价表）
5. TB_COMPLAINT（投诉表）
6. TB_ADMIN（管理员表）
7. TB_ROLE（角色表）
8. TB_DICTIONARY（数据字典表）
9. TB_OPERATION_LOG（操作日志表）

要求：
- 每张表都要设置主键、外键、唯一约束、检查约束、非空约束
- 为高频查询字段创建索引
- 使用序列作为主键自增方式
- 每张表都有create_time、update_time、is_deleted字段
- 订单表需要按季度进行范围分区

请提供完整的CREATE TABLE语句，包括所有约束和索引。
```

**提示词3：生成存储过程和函数**
```
请为游戏陪玩系统生成Oracle存储过程和函数，要求如下：

存储过程1：PROC_CREATE_ORDER（创建订单）
- 输入参数：客户ID、陪玩ID、游戏类型、服务时长、单价
- 输出参数：订单号、结果状态、消息
- 功能：
  1. 检查陪玩人员状态是否为"空闲"
  2. 检查客户账户状态是否正常
  3. 计算总金额（服务时长 * 单价）
  4. 计算平台抽成（默认20%）和陪玩收入
  5. 生成订单号（格式：PM + 年月日 + 10位序列号）
  6. 插入订单数据
  7. 更新陪玩人员状态为"忙碌"
  8. 包含异常处理，失败时回滚事务

存储过程2：PROC_COMPLETE_ORDER（完成订单）
- 输入参数：订单ID
- 输出参数：结果状态、消息
- 功能：
  1. 检查订单状态是否为"服务中"
  2. 更新订单状态为"已完成"，设置结束时间
  3. 更新陪玩人员状态为"空闲"
  4. 增加陪玩人员的总收入和订单数
  5. 增加客户的订单数
  6. 包含异常处理

函数1：FUNC_CALC_STAFF_INCOME（计算陪玩人员收入）
- 输入参数：陪玩ID、开始时间（可选）、结束时间（可选）
- 返回值：总收入
- 功能：计算指定时间范围内陪玩人员的总收入

函数2：FUNC_GET_STAFF_AVG_SCORE（获取陪玩人员平均评分）
- 输入参数：陪玩ID
- 返回值：平均评分（保留2位小数）
- 功能：计算陪玩人员的平均评分，如果没有评价返回5.00

请提供完整的PL/SQL代码，包括异常处理。
```

**提示词4：生成触发器和视图**
```
请为游戏陪玩系统生成Oracle触发器和视图，要求如下：

触发器1：TRIG_STAFF_UPDATE_TIME
- 表：TB_STAFF
- 触发时机：UPDATE之前
- 功能：自动更新UPDATE_TIME字段为当前时间

触发器2：TRIG_ORDER_UPDATE_TIME
- 表：TB_ORDER
- 触发时机：UPDATE之前
- 功能：自动更新UPDATE_TIME字段为当前时间

触发器3：TRIG_AUTO_EVALUATION
- 表：TB_ORDER
- 触发时机：UPDATE之后，当ORDER_STATUS从"服务中"变为"已完成"
- 功能：
  1. 检查该订单是否已有评价
  2. 如果没有评价，自动插入一条好评（评分5分，内容"系统自动好评：服务满意"）

触发器4：TRIG_EVALUATION_UPDATE_SCORE
- 表：TB_EVALUATION
- 触发时机：INSERT或UPDATE（评分字段）
- 功能：
  1. 重新计算陪玩人员的平均评分
  2. 更新TB_STAFF表的AVG_SCORE字段

视图1：VIEW_STAFF_PERFORMANCE（陪玩人员业绩视图）
- 字段：陪玩ID、陪玩昵称、真实姓名、技能等级、单价、平均评分、
        总订单数、总销售额、总收入、平均订单金额、状态、创建时间
- 关联：TB_STAFF左连接TB_ORDER

视图2：VIEW_CUSTOMER_CONSUMPTION（客户消费统计视图）
- 字段：客户ID、用户名、昵称、手机号、会员等级、订单数、
        总消费、平均消费、最后下单时间、余额、状态、注册时间
- 关联：TB_CUSTOMER左连接TB_ORDER

视图3：VIEW_ORDER_DETAIL（订单详情视图）
- 字段：订单基本信息 + 客户信息 + 陪玩信息 + 评价信息 + 投诉信息
- 关联：TB_ORDER左连接TB_CUSTOMER、TB_STAFF、TB_EVALUATION、TB_COMPLAINT

视图4：VIEW_FINANCE_SUMMARY（财务汇总视图）
- 字段：统计日期、订单数、总销售额、平台收入、陪玩收入、
        完成订单数、退款订单数、退款金额
- 按日期分组统计

请提供完整的SQL代码。
```

**提示词5：生成权限管理SQL**
```
请为游戏陪玩系统生成Oracle权限管理SQL，要求如下：

1. 创建以下角色：
   - ROLE_SUPER_ADMIN（超级管理员）：具备所有表的增删改查、存储过程执行、触发器管理权限
   - ROLE_OPERATOR（运营管理员）：陪玩人员管理、订单管理、评价管理的权限
   - ROLE_CUSTOMER_SERVICE（客服人员）：客户查看、投诉处理、评价管理权限
   - ROLE_FINANCE（财务人员）：财务管理、提现审核权限
   - ROLE_VIEWER（查看员）：所有表的只读权限

2. 为每个角色授予相应的权限：
   - 表权限：SELECT、INSERT、UPDATE、DELETE
   - 视图权限：SELECT
   - 存储过程权限：EXECUTE
   - 序列权限：SELECT

3. 创建以下用户并分配角色：
   - USER_SUPER_ADMIN（超级管理员）
   - USER_OPERATOR（运营人员）
   - USER_CUSTOMER_SERVICE（客服人员）
   - USER_FINANCE（财务人员）
   - USER_VIEWER（查看员）

4. 每个用户设置不同的密码和默认表空间

请提供完整的CREATE ROLE、GRANT、CREATE USER语句。
```

**提示词6：生成闪回技术演示SQL**
```
请为Oracle数据库生成闪回技术演示SQL脚本，要求如下：

场景1：误删除数据恢复
- 模拟误删除：DELETE FROM TB_STAFF WHERE STAFF_ID = 10001;
- 使用闪回查询查看删除前的数据
- 使用闪回表恢复数据到5分钟前的状态
- 验证恢复结果

场景2：误删表恢复
- 模拟误删表：DROP TABLE TB_DICTIONARY;
- 查询回收站中的对象
- 使用闪回删除恢复表
- 验证恢复结果

场景3：误更新数据恢复
- 模拟误更新：UPDATE TB_ORDER SET ORDER_STATUS = '已退款' WHERE ORDER_ID = 3000000001;
- 使用闪回查询查看更新前的数据
- 使用闪回查询恢复数据
- 验证恢复结果

请提供完整的SQL脚本，包括模拟误操作、闪回恢复、验证结果的所有步骤，并添加详细注释说明每步的作用。
```

### 6.2 前端Vue.js代码生成提示词

**提示词7：生成陪玩人员管理Vue页面**
```
请生成一个基于Vue.js 3 + Element Plus的陪玩人员管理页面，要求如下：

页面功能：
1. 搜索栏：
   - 陪玩昵称（输入框）
   - 技能等级（下拉框：全部、青铜、白银、黄金、铂金、钻石、王者）
   - 状态（下拉框：全部、空闲、忙碌、离线、封禁）
   - 查询和重置按钮

2. 操作栏：
   - 新增陪玩按钮
   - 导出数据按钮

3. 数据表格：
   - 列：序号、ID、陪玩昵称、真实姓名、性别、年龄、手机号、
        技能等级、服务类型、单价、订单数、总收入、评分、状态、
        创建时间、操作
   - 操作列：编辑、删除、更多（详情、订单记录、收入明细）
   - 分页：每页10/20/50/100条
   - 加载状态

4. 新增/编辑对话框：
   - 表单字段：陪玩昵称、真实姓名、性别（单选）、年龄（数字输入）、
               手机号、邮箱、技能等级（下拉）、服务类型（多选）、
               单价（数字输入）、状态（下拉）
   - 表单验证
   - 提交和取消按钮

5. 样式：
   - 使用卡片布局
   - 响应式设计
   - 状态标签使用不同颜色
   - 评分使用星级组件

请提供完整的Vue单文件组件代码，包括template、script、style三部分。
```

**提示词8：生成订单管理Vue页面**
```
请生成一个基于Vue.js 3 + Element Plus的订单管理页面，要求如下：

页面功能：
1. 搜索栏：
   - 订单号、客户名称、陪玩昵称（输入框）
   - 游戏类型、订单状态（下拉框）
   - 创建时间（日期范围选择器）
   - 查询和重置按钮

2. 操作栏：
   - 创建订单按钮
   - 导出数据按钮
   - 批量取消按钮

3. 统计卡片：
   - 今日订单数、今日收入、待处理订单、已完成订单

4. 数据表格：
   - 列：多选框、序号、订单号、客户名称、陪玩昵称、
        游戏类型、服务时长、单价、总金额、订单状态、
        创建时间、支付时间、操作
   - 操作列：详情、确认支付、开始服务、完成服务、取消（根据状态显示）
   - 分页功能

5. 创建订单对话框：
   - 选择客户（可搜索下拉）
   - 选择陪玩（可搜索下拉，只显示空闲陪玩）
   - 游戏类型（下拉）
   - 服务时长（数字输入）
   - 实时显示单价和总金额
   - 表单验证

6. 样式：
   - 卡片布局
   - 统计卡片使用不同颜色
   - 状态标签使用不同颜色

请提供完整的Vue单文件组件代码。
```

**提示词9：生成客户管理Vue页面**
```
请生成一个基于Vue.js 3 + Element Plus的客户管理页面，要求如下：

页面功能：
1. 搜索栏：
   - 用户名、手机号（输入框）
   - 会员等级、状态（下拉框）
   - 注册时间（日期范围）
   - 查询和重置按钮

2. 操作栏：
   - 新增客户按钮
   - 批量操作（冻结、解冻、删除）

3. 数据表格：
   - 列：多选框、序号、ID、用户名、昵称、手机号、邮箱、
        性别、年龄、会员等级、总消费、订单数、余额、状态、
        注册时间、最后登录时间、操作
   - 操作列：编辑、删除、详情、充值、消费记录
   - 分页功能

4. 新增/编辑对话框：
   - 表单字段：用户名、密码、昵称、手机号、邮箱、性别、年龄、
               会员等级、余额、状态
   - 表单验证

5. 充值对话框：
   - 充值金额输入
   - 备注

6. 样式：
   - 卡片布局
   - 会员等级使用不同颜色标签
   - 状态使用不同颜色标签

请提供完整的Vue单文件组件代码。
```

**提示词10：生成评价与投诉管理Vue页面**
```
请生成一个基于Vue.js 3 + Element Plus的评价与投诉管理页面，要求如下：

页面功能分为两个标签页：

标签页1：评价管理
1. 搜索栏：
   - 订单号、陪玩昵称、客户名称（输入框）
   - 评分（下拉框：1-5星）
   - 评价时间（日期范围）
   - 查询按钮

2. 数据表格：
   - 列：序号、订单号、陪玩昵称、客户名称、评分（星级显示）、
        评价内容、标签、是否匿名、回复状态、评价时间、操作
   - 操作列：查看详情、回复

3. 回复对话框：
   - 评价内容（只读）
   - 回复内容输入框

标签页2：投诉管理
1. 搜索栏：
   - 订单号、投诉类型（下拉框）
   - 投诉状态（下拉框：待处理、处理中、已解决、已关闭）
   - 投诉时间（日期范围）
   - 查询按钮

2. 数据表格：
   - 列：序号、订单号、客户名称、陪玩昵称、投诉类型、
        投诉内容、投诉状态、处理人、处理时间、操作
   - 操作列：查看详情、处理

3. 处理对话框：
   - 投诉信息（只读）
   - 处理结果输入框
   - 处理状态选择

样式：
- 使用标签页布局
- 评分使用星级组件
- 状态使用不同颜色标签

请提供完整的Vue单文件组件代码。
```

### 6.3 后端SpringBoot代码生成提示词

**提示词11：生成SpringBoot实体类和Mapper**
```
请为游戏陪玩系统生成SpringBoot实体类和MyBatis Mapper接口，要求如下：

实体类（Entity）：
1. Staff（陪玩人员）
   - 字段：staffId, staffName, realName, gender, age, phone, email,
           avatarUrl, skillLevel, serviceType, unitPrice, status,
           totalOrders, totalIncome, avgScore, certStatus,
           createTime, updateTime, lastLoginTime, isDeleted
   - 使用Lombok注解（@Data, @EqualsAndHashCode）
   - 实现Serializable

2. Customer（客户）
   - 字段：customerId, username, password, nickname, phone, email,
           gender, age, avatarUrl, memberLevel, totalConsume,
           orderCount, balance, status, createTime, updateTime,
           lastLoginTime, isDeleted

3. Order（订单）
   - 字段：orderId, orderNo, customerId, staffId, gameType,
           serviceHours, unitPrice, totalAmount, platformCommission,
           staffIncome, orderStatus, payTime, startTime, endTime,
           customerComment, staffComment, createTime, updateTime, isDeleted

4. Evaluation（评价）
5. Complaint（投诉）
6. Admin（管理员）
7. Role（角色）
8. Dictionary（数据字典）

Mapper接口：
1. StaffMapper：
   - 分页查询：List<Staff> findPage(@Param("offset") int offset, @Param("size") int size, @Param("query") Map<String, Object> query)
   - 统计：int count(@Param("query") Map<String, Object> query)
   - 增删改查方法

2. CustomerMapper：
   - 类似的分页查询和CRUD方法

3. OrderMapper：
   - 分页查询订单列表
   - 按条件统计
   - 更新订单状态
   - 查询订单统计信息

要求：
- 使用MyBatis注解或XML配置
- 支持分页查询
- 支持逻辑删除（is_deleted字段）
- 驼峰命名自动映射

请提供完整的Java代码。
```

**提示词12：生成订单服务层代码**
```
请为游戏陪玩系统生成SpringBoot订单服务层代码，要求如下：

接口：OrderService
1. 创建订单（createOrder）
   - 参数：OrderCreateDTO
   - 返回：订单号
   - 功能：
     * 验证客户和陪玩人员状态
     * 计算总金额、平台抽成、陪玩收入
     * 生成订单号
     * 更新陪玩人员状态为"忙碌"
     * 使用事务管理

2. 分页查询订单列表（getOrderList）
   - 参数：OrderQueryDTO（包含分页参数、查询条件）
   - 返回：PageResult<Order>
   - 功能：
     * 支持按订单号、客户、陪玩、游戏类型、状态、时间范围查询
     * 关联查询客户和陪玩信息
     * 分页查询

3. 根据ID查询订单（getOrderById）
   - 关联查询客户和陪玩信息

4. 更新订单状态（updateOrderStatus）
   - 参数：订单ID、新状态
   - 根据状态执行相应业务逻辑

5. 完成订单（completeOrder）
   - 更新订单状态为"已完成"
   - 更新陪玩人员状态为"空闲"
   - 增加陪玩人员总收入和订单数
   - 增加客户订单数

6. 取消订单（cancelOrder）
   - 更新订单状态为"已取消"
   - 恢复陪玩人员状态为"空闲"

7. 获取订单统计信息（getOrderStatistics）
   - 今日订单数、今日收入、待处理订单、已完成订单

实现类：OrderServiceImpl
- 使用@Service注解
- 使用@Transactional注解
- 注入OrderMapper、StaffMapper、CustomerMapper
- 实现所有接口方法

DTO类：
1. OrderCreateDTO：客户ID、陪玩ID、游戏类型、服务时长、单价
2. OrderQueryDTO：分页参数、查询条件

请提供完整的Java代码，包括接口、实现类、DTO类。
```

**提示词13：生成统一返回结果和分页工具类**
```
请为SpringBoot项目生成统一返回结果类和分页工具类，要求如下：

1. Result类（统一返回结果）
   - 字段：code（状态码）、message（消息）、data（数据）、timestamp（时间戳）
   - 静态方法：
     * success()：成功无数据
     * success(T data)：成功有数据
     * success(String message, T data)：成功有消息和数据
     * error(String message)：失败消息
     * error(Integer code, String message)：失败状态码和消息
   - 使用泛型
   - 自动设置时间戳

2. PageResult类（分页结果）
   - 字段：total（总记录数）、records（数据列表）、size（每页大小）、current（当前页）
   - 构造函数：
     * PageResult(long total, List<T> records)
     * PageResult(long total, List<T> records, long size, long current)

3. PageQuery类（分页查询参数）
   - 字段：page（当前页）、size（每页大小）
   - 方法：getOffset()（获取偏移量）

4. 使用Lombok注解简化代码

请提供完整的Java代码。
```

**提示词14：生成Controller层代码**
```
请为游戏陪玩系统生成SpringBoot Controller层代码，要求如下：

1. StaffController（陪玩人员管理）
   - 路径：/api/staff
   - 方法：
     * GET /list：分页查询
     * GET /detail/{id}：查询详情
     * POST /add：新增
     * PUT /update：更新
     * DELETE /delete/{id}：删除
     * GET /statistics：统计信息

2. CustomerController（客户管理）
   - 类似的方法
   - 额外方法：
     * POST /recharge：充值
     * GET /consumption/{id}：消费记录

3. OrderController（订单管理）
   - 路径：/api/order
   - 方法：
     * POST /create：创建订单
     * GET /list：分页查询
     * GET /detail/{id}：查询详情
     * PUT /status/{id}：更新状态
     * PUT /complete/{id}：完成订单
     * PUT /cancel/{id}：取消订单
     * PUT /batch/cancel：批量取消
     * GET /statistics：统计信息

4. 统一特性：
   - 使用@RestController注解
   - 使用@RequestMapping定义路径
   - 使用@CrossOrigin解决跨域
   - 返回Result统一结果
   - 参数验证
   - 异常处理

请提供完整的Java代码。
```

**提示词15：生成配置文件和启动类**
```
请为SpringBoot项目生成配置文件和启动类，要求如下：

1. application.yml（主配置文件）
   - 服务器端口：8080
   - 上下文路径：/api
   - 激活环境：dev

2. application-dev.yml（开发环境配置）
   - 数据源配置：
     * 使用Druid连接池
     * Oracle数据库驱动
     * URL：jdbc:oracle:thin:@localhost:1521:pdb_playmate
     * 用户名和密码
     * 连接池配置：初始连接数5，最小5，最大20，最大等待60秒
   - MyBatis配置：
     * Mapper路径：classpath:mapper/*.xml
     * 别名包：com.playmate.admin.model.entity
     * 开启驼峰命名自动映射
     * 开启SQL日志
   - 日志配置：
     * Mapper包日志级别：debug

3. 启动类：PlaymateAdminApplication
   - 使用@SpringBootApplication注解
   - 使用@MapperScan扫描Mapper接口
   - main方法

4. MyBatis配置类：MyBatisConfig
   - 配置SqlSessionFactory
   - 配置SqlSessionTemplate

5. Druid配置类：DruidConfig
   - 配置数据源
   - 配置监控（可选）

请提供完整的YAML和Java代码。
```

---

## 七、项目亮点总结

### 7.1 数据库层面
1. ✅ **PDB架构设计**：创建独立的可插拔数据库，实现资源隔离
2. ✅ **表空间拆分**：按业务模块拆分6个表空间，优化性能和管理
3. ✅ **分区表应用**：订单表按季度范围分区，提升大数据量查询性能
4. ✅ **完整约束设计**：主键、外键、唯一约束、检查约束、非空约束
5. ✅ **索引优化**：为高频查询字段创建索引
6. ✅ **存储过程**：3个业务存储过程，实现复杂业务逻辑
7. ✅ **触发器**：4个触发器，实现自动更新和数据统计
8. ✅ **视图**：4个统计视图，简化复杂查询
9. ✅ **权限管理**：5个角色，实现细粒度权限控制
10. ✅ **闪回技术**：支持误操作恢复

### 7.2 后端层面
1. ✅ **SpringBoot框架**：快速开发，约定优于配置
2. ✅ **MyBatis ORM**：简化数据库操作，支持复杂SQL
3. ✅ **Druid连接池**：高性能数据库连接池，支持监控
4. ✅ **统一返回结果**：Result类标准化接口返回
5. ✅ **分页封装**：PageResult类统一分页结果
6. ✅ **RESTful API**：符合REST规范的接口设计
7. ✅ **跨域处理**：支持前后端分离部署

### 7.3 前端层面
1. ✅ **Vue.js 3**：现代化前端框架，响应式数据绑定
2. ✅ **Element Plus**：美观的UI组件库
3. ✅ **组件化开发**：页面拆分为多个组件
4. ✅ **路由管理**：Vue Router实现页面跳转
5. ✅ **状态管理**：Vuex管理全局状态
6. ✅ **Axios请求**：统一的HTTP请求封装
7. ✅ **权限控制**：基于角色的菜单和按钮控制

### 7.4 业务层面
1. ✅ **陪玩人员全生命周期管理**：增删改查、状态管理、技能管理
2. ✅ **客户全生命周期管理**：注册、充值、消费、等级管理
3. ✅ **订单完整流程**：创建、支付、服务、完成、取消、退款
4. ✅ **评价投诉管理**：双向评价、投诉处理流程
5. ✅ **财务管理**：收入统计、提现管理、分润计算
6. ✅ **系统管理**：管理员、角色、权限、日志、字典
7. ✅ **数据统计**：多维度数据报表和图表展示

---

## 八、使用建议

### 8.1 开发顺序建议
1. **第一阶段**：数据库设计（表、约束、索引、序列）
2. **第二阶段**：数据库对象（存储过程、函数、触发器、视图）
3. **第三阶段**：权限管理（角色、用户、授权）
4. **第四阶段**：后端基础框架（实体类、Mapper、Service、Controller）
5. **第五阶段**：前端基础框架（路由、组件、API封装）
6. **第六阶段**：页面开发（各功能模块页面）
7. **第七阶段**：测试和优化（功能测试、性能优化）
8. **第八阶段**：文档整理（设计文档、使用说明）

### 8.2 AI工具使用建议
1. **数据库SQL生成**：使用ChatGPT、Claude等AI工具生成SQL，然后人工验证
2. **前后端代码生成**：使用AI生成基础代码框架，然后补充业务逻辑
3. **代码优化**：使用AI进行代码重构和优化建议
4. **问题排查**：遇到问题时使用AI辅助分析

### 8.3 评分提升建议
1. **文档完整性**：确保设计文档、测试报告、使用说明齐全
2. **截图完整性**：每个功能点都要有界面截图和数据库截图
3. **代码规范性**：遵循Java和Vue.js编码规范
4. **业务逻辑完整性**：确保每个功能都能正常运行
5. **创新性**：可以适当添加一些创新功能（如数据可视化、智能推荐等）

---

希望这份详细的设计方案和AI提示词能帮助你顺利完成期末大作业！如果有任何问题，随时告诉我。🎮✨
