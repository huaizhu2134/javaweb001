<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.oracle01.mapper.OrderMapper">

    <resultMap id="BaseResultMap" type="org.example.oracle01.model.Order">
        <id column="ORDER_ID" property="orderId" jdbcType="NUMERIC"/>
        <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR"/>
        <result column="CUSTOMER_ID" property="customerId" jdbcType="NUMERIC"/>
        <result column="STAFF_ID" property="staffId" jdbcType="NUMERIC"/>
        <result column="GAME_TYPE" property="gameType" jdbcType="VARCHAR"/>
        <result column="SERVICE_HOURS" property="serviceHours" jdbcType="NUMERIC"/>
        <result column="UNIT_PRICE" property="unitPrice" jdbcType="DECIMAL"/>
        <result column="TOTAL_AMOUNT" property="totalAmount" jdbcType="DECIMAL"/>
        <result column="PLATFORM_COMMISSION" property="platformCommission" jdbcType="DECIMAL"/>
        <result column="STAFF_INCOME" property="staffIncome" jdbcType="DECIMAL"/>
        <result column="ORDER_STATUS" property="orderStatus" jdbcType="VARCHAR"/>
        <result column="PAY_TIME" property="payTime" jdbcType="TIMESTAMP"/>
        <result column="START_TIME" property="startTime" jdbcType="TIMESTAMP"/>
        <result column="END_TIME" property="endTime" jdbcType="TIMESTAMP"/>
        <result column="CUSTOMER_COMMENT" property="customerComment" jdbcType="VARCHAR"/>
        <result column="STAFF_COMMENT" property="staffComment" jdbcType="VARCHAR"/>
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="IS_DELETED" property="isDeleted" jdbcType="CHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
        ORDER_ID, ORDER_NO, CUSTOMER_ID, STAFF_ID, GAME_TYPE, SERVICE_HOURS, 
        UNIT_PRICE, TOTAL_AMOUNT, PLATFORM_COMMISSION, STAFF_INCOME, ORDER_STATUS, 
        PAY_TIME, START_TIME, END_TIME, CUSTOMER_COMMENT, STAFF_COMMENT, 
        CREATE_TIME, UPDATE_TIME, IS_DELETED
    </sql>

    <select id="selectOrderList" parameterType="map" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM TB_ORDER
        WHERE IS_DELETED = 'N'
        <if test="params.orderNo != null and params.orderNo != ''">
            AND ORDER_NO LIKE CONCAT('%', #{params.orderNo}, '%')
        </if>
        <if test="params.customerId != null">
            AND CUSTOMER_ID = #{params.customerId}
        </if>
        <if test="params.staffId != null">
            AND STAFF_ID = #{params.staffId}
        </if>
        <if test="params.orderStatus != null and params.orderStatus != ''">
            AND ORDER_STATUS = #{params.orderStatus}
        </if>
        ORDER BY CREATE_TIME DESC
        <if test="params.page != null and params.size != null">
            OFFSET #{params.page} ROWS
            FETCH NEXT #{params.size} ROWS ONLY
        </if>
    </select>

    <select id="selectOrderById" parameterType="long" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM TB_ORDER
        WHERE ORDER_ID = #{id} AND IS_DELETED = 'N'
    </select>

    <insert id="insertOrder" parameterType="org.example.oracle01.model.Order">
        INSERT INTO TB_ORDER (
            ORDER_ID, ORDER_NO, CUSTOMER_ID, STAFF_ID, GAME_TYPE, 
            SERVICE_HOURS, UNIT_PRICE, TOTAL_AMOUNT, PLATFORM_COMMISSION, 
            STAFF_INCOME, ORDER_STATUS, PAY_TIME, START_TIME, END_TIME, 
            CUSTOMER_COMMENT, STAFF_COMMENT, CREATE_TIME, UPDATE_TIME, IS_DELETED
        ) VALUES (
            SEQ_ORDER_ID.NEXTVAL, #{orderNo}, #{customerId}, #{staffId}, 
            #{gameType}, #{serviceHours}, #{unitPrice}, #{totalAmount}, 
            #{platformCommission}, #{staffIncome}, #{orderStatus}, 
            #{payTime}, #{startTime}, #{endTime}, #{customerComment}, 
            #{staffComment}, SYSDATE, SYSDATE, 'N'
        )
    </insert>

    <update id="updateOrder" parameterType="org.example.oracle01.model.Order">
        UPDATE TB_ORDER
        <set>
            <if test="orderNo != null">ORDER_NO = #{orderNo},</if>
            <if test="customerId != null">CUSTOMER_ID = #{customerId},</if>
            <if test="staffId != null">STAFF_ID = #{staffId},</if>
            <if test="gameType != null">GAME_TYPE = #{gameType},</if>
            <if test="serviceHours != null">SERVICE_HOURS = #{serviceHours},</if>
            <if test="unitPrice != null">UNIT_PRICE = #{unitPrice},</if>
            <if test="totalAmount != null">TOTAL_AMOUNT = #{totalAmount},</if>
            <if test="platformCommission != null">PLATFORM_COMMISSION = #{platformCommission},</if>
            <if test="staffIncome != null">STAFF_INCOME = #{staffIncome},</if>
            <if test="orderStatus != null">ORDER_STATUS = #{orderStatus},</if>
            <if test="payTime != null">PAY_TIME = #{payTime},</if>
            <if test="startTime != null">START_TIME = #{startTime},</if>
            <if test="endTime != null">END_TIME = #{endTime},</if>
            <if test="customerComment != null">CUSTOMER_COMMENT = #{customerComment},</if>
            <if test="staffComment != null">STAFF_COMMENT = #{staffComment},</if>
            UPDATE_TIME = SYSDATE,
        </set>
        WHERE ORDER_ID = #{orderId} AND IS_DELETED = 'N'
    </update>

    <update id="deleteOrder" parameterType="long">
        UPDATE TB_ORDER
        SET IS_DELETED = 'Y', UPDATE_TIME = SYSDATE
        WHERE ORDER_ID = #{id}
    </update>

    <select id="countOrder" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM TB_ORDER
        WHERE IS_DELETED = 'N'
        <if test="params.orderNo != null and params.orderNo != ''">
            AND ORDER_NO LIKE CONCAT('%', #{params.orderNo}, '%')
        </if>
        <if test="params.customerId != null">
            AND CUSTOMER_ID = #{params.customerId}
        </if>
        <if test="params.staffId != null">
            AND STAFF_ID = #{params.staffId}
        </if>
        <if test="params.orderStatus != null and params.orderStatus != ''">
            AND ORDER_STATUS = #{params.orderStatus}
        </if>
    </select>

    <update id="updateOrderStatus" parameterType="map">
        UPDATE TB_ORDER
        SET ORDER_STATUS = #{status}, UPDATE_TIME = SYSDATE
        WHERE ORDER_ID = #{id}
    </update>
</mapper>