<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.oracle01.mapper.AdminMapper">

    <resultMap id="BaseResultMap" type="org.example.oracle01.model.Admin">
        <id column="ADMIN_ID" property="adminId" jdbcType="NUMERIC"/>
        <result column="USERNAME" property="username" jdbcType="VARCHAR"/>
        <result column="PASSWORD" property="password" jdbcType="VARCHAR"/>
        <result column="NICKNAME" property="nickname" jdbcType="VARCHAR"/>
        <result column="PHONE" property="phone" jdbcType="VARCHAR"/>
        <result column="EMAIL" property="email" jdbcType="VARCHAR"/>
        <result column="ROLE_ID" property="roleId" jdbcType="NUMERIC"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="LAST_LOGIN_TIME" property="lastLoginTime" jdbcType="TIMESTAMP"/>
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="IS_DELETED" property="isDeleted" jdbcType="CHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
        ADMIN_ID, USERNAME, PASSWORD, NICKNAME, PHONE, EMAIL, 
        ROLE_ID, STATUS, LAST_LOGIN_TIME, CREATE_TIME, UPDATE_TIME, IS_DELETED
    </sql>

    <select id="selectAdminList" parameterType="map" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM TB_ADMIN
        WHERE IS_DELETED = 'N'
        <if test="params.username != null and params.username != ''">
            AND USERNAME LIKE CONCAT('%', #{params.username}, '%')
        </if>
        <if test="params.status != null and params.status != ''">
            AND STATUS = #{params.status}
        </if>
        ORDER BY CREATE_TIME DESC
        <if test="params.page != null and params.size != null">
            OFFSET #{params.page} ROWS
            FETCH NEXT #{params.size} ROWS ONLY
        </if>
    </select>

    <select id="selectAdminById" parameterType="long" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM TB_ADMIN
        WHERE ADMIN_ID = #{id} AND IS_DELETED = 'N'
    </select>

    <select id="selectAdminByUsername" parameterType="string" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM TB_ADMIN
        WHERE USERNAME = #{username} AND IS_DELETED = 'N'
    </select>

    <insert id="insertAdmin" parameterType="org.example.oracle01.model.Admin">
        INSERT INTO TB_ADMIN (
            ADMIN_ID, USERNAME, PASSWORD, NICKNAME, PHONE, EMAIL, 
            ROLE_ID, STATUS, LAST_LOGIN_TIME, CREATE_TIME, 
            UPDATE_TIME, IS_DELETED
        ) VALUES (
            SEQ_ADMIN_ID.NEXTVAL, #{username}, #{password}, #{nickname}, 
            #{phone}, #{email}, #{roleId}, #{status}, #{lastLoginTime}, 
            SYSDATE, SYSDATE, 'N'
        )
    </insert>

    <update id="updateAdmin" parameterType="org.example.oracle01.model.Admin">
        UPDATE TB_ADMIN
        <set>
            <if test="username != null">USERNAME = #{username},</if>
            <if test="password != null">PASSWORD = #{password},</if>
            <if test="nickname != null">NICKNAME = #{nickname},</if>
            <if test="phone != null">PHONE = #{phone},</if>
            <if test="email != null">EMAIL = #{email},</if>
            <if test="roleId != null">ROLE_ID = #{roleId},</if>
            <if test="status != null">STATUS = #{status},</if>
            <if test="lastLoginTime != null">LAST_LOGIN_TIME = #{lastLoginTime},</if>
            UPDATE_TIME = SYSDATE,
        </set>
        WHERE ADMIN_ID = #{adminId} AND IS_DELETED = 'N'
    </update>

    <update id="deleteAdmin" parameterType="long">
        UPDATE TB_ADMIN
        SET IS_DELETED = 'Y', UPDATE_TIME = SYSDATE
        WHERE ADMIN_ID = #{id}
    </update>

    <select id="countAdmin" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM TB_ADMIN
        WHERE IS_DELETED = 'N'
        <if test="params.username != null and params.username != ''">
            AND USERNAME LIKE CONCAT('%', #{params.username}, '%')
        </if>
        <if test="params.status != null and params.status != ''">
            AND STATUS = #{params.status}
        </if>
    </select>
</mapper>