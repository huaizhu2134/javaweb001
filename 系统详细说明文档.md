# 游戏陪玩后台管理系统 - 详细技术文档

## 1. 项目概述

游戏陪玩后台管理系统是一个基于 Spring Boot + Vue 3 的全栈 Web 应用，旨在为游戏陪玩服务提供完整的管理功能。系统包含陪玩人员管理、客户管理、订单管理、评价管理、投诉管理、财务管理等功能模块。

## 2. 技术栈与框架

### 2.1 后端技术栈

- **编程语言**: Java 17
- **框架**: Spring Boot 3.2.0
- **持久层框架**: MyBatis 3.0.3
- **数据库**: MySQL 8.0.33
- **连接池**: Druid 1.2.8
- **Web 框架**: Spring MVC
- **数据验证**: Spring Boot Validation
- **开发工具**: Maven, Spring Boot DevTools

### 2.2 前端技术栈

- **框架**: Vue 3
- **UI 组件库**: Element Plus 2.13.0
- **HTTP 客户端**: Axios 1.13.2
- **路由**: Vue Router 4.6.4
- **构建工具**: Vite 7.3.0
- **图表库**: ECharts 6.0.0

### 2.3 开发环境

- **服务器**: 内嵌 Tomcat (通过 Spring Boot)
- **端口**: 8080
- **开发工具**: 支持热重载

## 3. 数据库设计与关联

### 3.1 核心表结构

#### 3.1.1 陪玩人员表 (TB_STAFF)

- **主键**: STAFF_ID (自增)
- **字段**:
  - STAFF_NAME (陪玩昵称)
  - REAL_NAME (真实姓名)
  - GENDER (性别)
  - AGE (年龄)
  - PHONE (手机号)
  - EMAIL (邮箱)
  - AVATAR_URL (头像 URL)
  - SKILL_LEVEL (技能等级)
  - SERVICE_TYPE (服务类型)
  - UNIT_PRICE (单价)
  - STATUS (状态: 空闲/忙碌/离线/封禁)
  - TOTAL_ORDERS (总订单数)
  - TOTAL_INCOME (总收入)
  - AVG_SCORE (平均评分)
  - CERT_STATUS (认证状态)
  - CREATE_TIME (创建时间)
  - UPDATE_TIME (更新时间)
  - LAST_LOGIN_TIME (最后登录时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.2 客户表 (TB_CUSTOMER)

- **主键**: CUSTOMER_ID (自增)
- **字段**:
  - USERNAME (用户名)
  - PASSWORD (密码)
  - NICKNAME (昵称)
  - PHONE (手机号)
  - EMAIL (邮箱)
  - GENDER (性别)
  - AGE (年龄)
  - AVATAR_URL (头像 URL)
  - MEMBER_LEVEL (会员等级)
  - TOTAL_CONSUME (总消费)
  - ORDER_COUNT (订单数)
  - BALANCE (余额)
  - STATUS (状态: 正常/冻结/注销)
  - CREATE_TIME (创建时间)
  - UPDATE_TIME (更新时间)
  - LAST_LOGIN_TIME (最后登录时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.3 订单表 (TB_ORDER)

- **主键**: ORDER_ID (自增)
- **外键**: CUSTOMER_ID (引用 TB_CUSTOMER), STAFF_ID (引用 TB_STAFF)
- **字段**:
  - ORDER_NO (订单号)
  - GAME_TYPE (游戏类型)
  - SERVICE_HOURS (服务时长)
  - UNIT_PRICE (单价)
  - TOTAL_AMOUNT (总金额)
  - PLATFORM_COMMISSION (平台佣金)
  - STAFF_INCOME (陪玩收入)
  - ORDER_STATUS (订单状态)
  - PAY_TIME (支付时间)
  - START_TIME (开始时间)
  - END_TIME (结束时间)
  - CUSTOMER_COMMENT (客户评价)
  - STAFF_COMMENT (陪玩评价)
  - CREATE_TIME (创建时间)
  - UPDATE_TIME (更新时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.4 评价表 (TB_EVALUATION)

- **主键**: EVAL_ID (自增)
- **外键**: ORDER_ID (引用 TB_ORDER), CUSTOMER_ID (引用 TB_CUSTOMER), STAFF_ID (引用 TB_STAFF)
- **字段**:
  - SCORE (评分)
  - CONTENT (评价内容)
  - TAGS (标签)
  - IS_ANONYMOUS (是否匿名)
  - STAFF_REPLY (陪玩回复)
  - REPLY_TIME (回复时间)
  - CREATE_TIME (创建时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.5 投诉表 (TB_COMPLAINT)

- **主键**: COMPLAINT_ID (自增)
- **外键**: ORDER_ID (引用 TB_ORDER), CUSTOMER_ID (引用 TB_CUSTOMER), STAFF_ID (引用 TB_STAFF)
- **字段**:
  - COMPLAINT_TYPE (投诉类型)
  - COMPLAINT_CONTENT (投诉内容)
  - EVIDENCE_URL (证据 URL)
  - COMPLAINT_STATUS (投诉状态)
  - HANDLER_ID (处理人 ID)
  - HANDLER_COMMENT (处理人评论)
  - HANDLE_TIME (处理时间)
  - CREATE_TIME (创建时间)
  - UPDATE_TIME (更新时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.6 管理员表 (TB_ADMIN)

- **主键**: ADMIN_ID (自增)
- **外键**: ROLE_ID (引用 TB_ROLE)
- **字段**:
  - USERNAME (用户名)
  - PASSWORD (密码)
  - NICKNAME (昵称)
  - PHONE (手机号)
  - EMAIL (邮箱)
  - STATUS (状态)
  - LAST_LOGIN_TIME (最后登录时间)
  - CREATE_TIME (创建时间)
  - UPDATE_TIME (更新时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.7 角色表 (TB_ROLE)

- **主键**: ROLE_ID (自增)
- **字段**:
  - ROLE_NAME (角色名称)
  - ROLE_DESC (角色描述)
  - PERMISSIONS (权限)
  - CREATE_TIME (创建时间)
  - UPDATE_TIME (更新时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.8 数据字典表 (TB_DICTIONARY)

- **主键**: DICT_ID (自增)
- **字段**:
  - DICT_TYPE (字典类型)
  - DICT_CODE (字典代码)
  - DICT_VALUE (字典值)
  - DICT_DESC (字典描述)
  - SORT_ORDER (排序)
  - CREATE_TIME (创建时间)
  - IS_DELETED (逻辑删除标志)

#### 3.1.9 操作日志表 (TB_OPERATION_LOG)

- **主键**: LOG_ID (自增)
- **外键**: ADMIN_ID (引用 TB_ADMIN)
- **字段**:
  - ADMIN_NAME (管理员姓名)
  - OPERATION_TYPE (操作类型)
  - OPERATION_DESC (操作描述)
  - REQUEST_URL (请求 URL)
  - REQUEST_METHOD (请求方法)
  - REQUEST_IP (请求 IP)
  - REQUEST_PARAMS (请求参数)
  - RESPONSE_RESULT (响应结果)
  - EXECUTE_TIME (执行时间)
  - CREATE_TIME (创建时间)
  - IS_DELETED (逻辑删除标志)

### 3.2 表关联关系

- TB_ORDER 与 TB_CUSTOMER、TB_STAFF 通过外键关联
- TB_EVALUATION 与 TB_ORDER、TB_CUSTOMER、TB_STAFF 通过外键关联
- TB_COMPLAINT 与 TB_ORDER、TB_CUSTOMER、TB_STAFF 通过外键关联
- TB_ADMIN 与 TB_ROLE 通过外键关联
- TB_OPERATION_LOG 与 TB_ADMIN 通过外键关联

## 4. API 接口设计

### 4.1 通用响应格式

```json
{
  "code": 200, // 状态码
  "message": "操作成功", // 消息
  "data": {}, // 数据
  "timestamp": 1234567890 // 时间戳
}
```

### 4.2 分页响应格式

```json
{
  "total": 100, // 总记录数
  "records": [], // 数据列表
  "page": 1, // 当前页
  "size": 10, // 每页大小
  "totalPages": 10 // 总页数
}
```

### 4.3 API 端点列表

#### 4.3.1 陪玩人员管理 (/api/staff)

- GET /api/staff/list - 获取陪玩人员列表（支持分页、搜索）
- GET /api/staff/{id} - 根据 ID 获取陪玩人员详情
- POST /api/staff - 新增陪玩人员
- PUT /api/staff - 更新陪玩人员
- DELETE /api/staff/{id} - 删除陪玩人员

#### 4.3.2 客户管理 (/api/customer)

- GET /api/customer/list - 获取客户列表
- GET /api/customer/{id} - 获取客户详情
- POST /api/customer - 新增客户
- PUT /api/customer - 更新客户
- DELETE /api/customer/{id} - 删除客户

#### 4.3.3 订单管理 (/api/order)

- GET /api/order/list - 获取订单列表
- GET /api/order/{id} - 获取订单详情
- POST /api/order - 新增订单
- PUT /api/order - 更新订单
- DELETE /api/order/{id} - 删除订单

#### 4.3.4 评价管理 (/api/evaluation)

- GET /api/evaluation/list - 获取评价列表
- GET /api/evaluation/{id} - 获取评价详情
- POST /api/evaluation - 新增评价
- PUT /api/evaluation - 更新评价
- DELETE /api/evaluation/{id} - 删除评价

#### 4.3.5 投诉管理 (/api/complaint)

- GET /api/complaint/list - 获取投诉列表
- GET /api/complaint/{id} - 获取投诉详情
- POST /api/complaint - 新增投诉
- PUT /api/complaint - 更新投诉
- DELETE /api/complaint/{id} - 删除投诉

#### 4.3.6 财务管理 (/api/finance)

- GET /api/finance/list - 获取财务记录列表
- GET /api/finance/{id} - 获取财务记录详情
- POST /api/finance - 新增财务记录
- PUT /api/finance - 更新财务记录
- DELETE /api/finance/{id} - 删除财务记录

#### 4.3.7 管理员管理 (/api/admin)

- POST /api/admin/login - 管理员登录
- GET /api/admin/profile - 获取管理员信息
- GET /api/admin/list - 获取管理员列表

#### 4.3.8 角色管理 (/api/role)

- GET /api/role/list - 获取角色列表
- GET /api/role/{id} - 获取角色详情
- POST /api/role - 新增角色
- PUT /api/role - 更新角色
- DELETE /api/role/{id} - 删除角色

#### 4.3.9 数据字典管理 (/api/dictionary)

- GET /api/dictionary/list - 获取字典列表
- GET /api/dictionary/{id} - 获取字典详情
- POST /api/dictionary - 新增字典
- PUT /api/dictionary - 更新字典
- DELETE /api/dictionary/{id} - 删除字典

## 5. 功能具体实现

### 5.1 后端功能实现

#### 5.1.1 控制器层 (Controller)

- 使用@RestController 注解标记 REST 控制器
- 使用@RequestMapping 定义基础路径
- 使用@GetMapping、@PostMapping、@PutMapping、@DeleteMapping 定义 HTTP 方法
- 参数校验和绑定
- 统一返回 Result 格式

#### 5.1.2 服务层 (Service)

- 业务逻辑处理
- 事务管理 (@Transactional)
- 异常处理
- 数据验证
- 分页处理

#### 5.1.3 持久层 (Mapper)

- 使用@Mapper 注解
- 定义数据访问接口
- 与 MyBatis XML 映射文件配合使用
- SQL 查询优化

#### 5.1.4 实体类 (Model)

- 与数据库表结构对应
- 包含字段映射
- 提供 getter/setter 方法

#### 5.1.5 配置类

- 数据库连接配置
- MyBatis 配置
- 连接池配置 (Druid)
- 全局异常处理

### 5.2 前端功能实现

#### 5.2.1 组件结构

- 使用 Vue 3 Composition API
- Element Plus 组件库
- 响应式数据管理
- 生命周期钩子

#### 5.2.2 API 接口调用

- Axios HTTP 客户端
- 请求拦截器 (添加 token)
- 响应拦截器 (处理响应)
- 统一错误处理

#### 5.2.3 状态管理

- 使用 ref 和 reactive 管理状态
- 表单验证 (Element Plus 表单验证)
- 分页状态管理

#### 5.2.4 页面组件

- 搜索栏 (el-form)
- 数据表格 (el-table)
- 操作栏 (el-button)
- 分页器 (el-pagination)
- 对话框 (el-dialog)
- 状态标签 (StatusTag 组件)

## 6. 前后端交互流程

### 6.1 标准请求流程

1. 前端通过 Axios 发起 HTTP 请求
2. 请求拦截器自动添加认证 token
3. 后端 Spring Boot 控制器接收请求
4. 服务层处理业务逻辑
5. 持久层执行数据库操作
6. 返回统一格式的 Result 对象
7. 前端响应拦截器处理响应
8. 更新 UI 界面

### 6.2 具体交互示例 (新增陪玩人员)

#### 6.2.1 前端操作

1. 用户点击"新增陪玩"按钮
2. 打开对话框并清空表单
3. 用户填写表单信息
4. 点击"确定"按钮
5. 前端进行表单验证
6. 发起 POST 请求到 /api/staff

#### 6.2.2 后端处理

1. StaffController 接收 POST 请求
2. 调用 StaffService.addStaff 方法
3. StaffServiceImpl 执行新增逻辑
4. StaffMapper.insertStaff 执行 SQL
5. 返回 Result.success 结果

#### 6.2.3 前端响应

1. 接收后端返回的 Result 对象
2. 判断 code 是否为 200
3. 显示成功消息提示
4. 关闭对话框
5. 刷新数据列表

### 6.3 数据传输格式

- 请求参数: JSON 格式
- 响应数据: 统一 Result 格式
- 分页参数: page, size
- 搜索参数: 根据业务需求传递
- 认证信息: 通过 Authorization 头传递 JWT token

### 6.4 错误处理机制

- 前端: Element Plus 消息提示
- 后端: 全局异常处理器
- 数据库: 事务回滚机制
- 业务层: 参数验证和业务逻辑验证

## 7. 系统特性

### 7.1 安全性

- 参数校验
- SQL 注入防护 (MyBatis 预编译)
- 认证授权机制
- 敏感信息加密

### 7.2 性能优化

- 数据库连接池 (Druid)
- 分页查询
- 索引优化
- 前端防抖处理

### 7.3 可扩展性

- 模块化设计
- 统一 API 规范
- 配置化管理
- 插件化架构

### 7.4 易用性

- 响应式界面
- 直观的操作流程
- 友好的错误提示
- 丰富的筛选和搜索功能

## 8. 部署说明

### 8.1 后端部署

1. 确保 Java 17 环境
2. 配置 MySQL 数据库连接
3. 执行 SQL 脚本创建表结构
4. 使用 Maven 打包: `mvn package`
5. 运行 JAR 包: `java -jar oracle01.jar`

### 8.2 前端部署

1. 确保 Node.js 环境
2. 安装依赖: `npm install`
3. 构建项目: `npm run build`
4. 部署到 Web 服务器

### 8.3 配置文件

- application.properties: 后端配置
- package.json: 前端依赖配置
- vite.config.js: 前端构建配置
